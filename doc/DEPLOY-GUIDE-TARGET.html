<!doctype HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>

<head>
<title>Shibboleth Target Deployment Guide</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">

html
{	
background-color: #FFFFFF;
color: #000000;
margin: .5em;
}
a:visited
{
color: #999999;
}
a:link
{
color: #990000;
}
a:active
{
color: #440000;
}
a.fixedlink:visited
{
font-family: monospace;
font-size: 90%;
color: #121212;
text-decoration: none;
}
a.fixedlink:link
{
font-family: monospace;
font-size: 90%;
color: #121212;
text-decoration: none;
}
a.fixedlink:active
{
font-family: monospace;
font-size: 90%;
color: #121212;
text-decoration: none;
}
dl
{
border-width:2px; background-color: #DDDDDD;
background-image: url('none');
margin: 5px;
padding: 0px;
border-style: solid;
}
dt
{
background-color: #DDDDDD;
background-image: url('none');
margin: 1px;
padding: 1px
}
dd
{
background-color: #DDDDDD;
background-image: url('none');
margin: 0px;
padding: 1px
}
.attribute
{
font-size: 115%;
font-color: #000000;
text-align: left;
background-color: #DDDDDD;
border: 1px inset black;
background-image: url('none');
margin: 0px;
padding: 2px
}
.value
{
font-color: #000000;
text-align: left;
background-color: #EEEEEE;
background-image: url('none');
padding-top: 0em;
padding-bottom: 0.5em;
padding-right: 1em;
padding-left: 5em;
border-bottom-width: none;
border-top-width: none;
border-left-width: 1px;
border-right-width: 1px; border-left-style:solid; border-right-style:solid; border-top-style:solid; border-bottom-style:solid
}
.mandatory
{
font-color: #000000;
background-color: #FFCCFF;
}
.demo
{
background-color: #EEEEEE;
padding: 3px;
}
.fixed
{
font-family: monospace;
font-size: 90%;
font-color: #121212;
}
.feature
{
color: #00FF00
}

    </style>
</head>

<body link="red" vlink="red" alink="black" bgcolor="white">

<center>
<h2>Shibboleth Target Deployment Guide</h2>
</center>
<p>Shibboleth Target Deployment Guide<br>
Shibboleth Version 1.2<br />
April 4, 2004<br />
<h3>This version of the deploy guide is for Shibboleth v1.2. For documentation 
related to prior versions of Shibboleth, please consult the appropriate branch 
in the Shibboleth CVS.</h3>
<h3>The default configuration of Shibboleth is <b>not</b> secure and should not be
used for protection of production content. The example private key bundled with the
distribution is publically available, widely circulated, and well-known; also, the
default federation and trust metadata is for testing purposes only. For information
about securing a Shibboleth deployment, please refer to the production guide.
Shibboleth should only be used to protect sensitive content when deployed carefully
in conjunction with proper trust settings and policies.</h3>

<p>The Shibboleth target implementation has been substantially redesigned for this release. Most of the
configuration process has changed to accomodate more complex deployments but many of the defaults work
fine for testing and simpler applications. Among the new features:</p>
<ul>
    <li>New XML-based configuration system supporting runtime adjustment of many settings and better
        integration with supplemental configuration files</li>
    <li>Ability to partition deployment into "Applications" at the vhost, path, or document level</li>
    <li>"Lazy" sessions allow applications to redirect browser to initiate a session, allows
        content to decide it needs authentication or attributes at runtime</li>
    <li>Flexible support for multilateral and bilateral trust arrangements</li>
    <li>Support for more types of key and certificate formats</li>
    <li>Improved pluggability for many aspects of system, including access control modules</li>
</ul>

<p>Before starting, please sign up for all applicable
<a href="http://shibboleth.internet2.edu/shib-misc.html#mailinglist">mailing 
lists</a>. Announcements pertinent to Shibboleth deployments and developments 
and resources for deployment assistance can be found here.</p>
<p>Please send any questions, concerns, or eventual confusion to
<a href="mailto:shibboleth-users@internet2.edu">shibboleth-users@internet2.edu</a>. 
This should include, but not be limited to, questions about the documentation, 
undocumented problems, installation or operational issues, and anything else 
that arises.</p>
<p><br>
</p>
<hr>
<p><br>
<br>
</p>
<h3><a name="TOC"></a>Shibboleth Target -- Table of Contents</h3>
<ol type="1">
    <li>
    <h4><a href="#1."><font color="black">Shibboleth Overview</font></a></h4>
    <ol type="a">
        <li><a href="#1.a."><font color="black">Origin</font></a></li>
        <li><a href="#1.b."><font color="black">Target</font></a></li>
        <li><a href="#1.c."><font color="black">WAYF</font></a></li>
        <li><a href="#1.d."><font color="black">Federations</font></a></li>
    </ol>
    </li>
    <li>
    <h4><a href="#2."><font color="black">Planning</font></a></h4>
    <ol type="a">
        <li><a href="#2.a."><font color="black">Requirements</font></a></li>
        <li><a href="#2.b."><font color="black">Join a Federation</font></a></li>
        <li><a href="#2.c."><font color="black">Security Considerations</font></a></li>
        <li><a href="#2.d."><font color="black">Server Certificates</font></a></li>
        <li><a href="#2.e."><font color="black">Attribute Release Policies</font></a></li>
        <li><a href="#2.f."><font color="#000000">Attribute Acceptance Policies</font></a></li>
        <li><a href="#2.g."><font color="black">Browser Requirements</font></a></li>
        <li><a href="#2.h."><font color="black">Clocks</font></a></li>
        <li><a href="#2.i."><font color="black">Other Considerations</font></a></li>
    </ol>
    </li>
    <li>
    <h4><a href="#3."><font color="black">Installation</font></a></h4>
    <ol type="a">
        <li><a href="#3.a."><font color="black">Software Requirements</font></a></li>
        <li><a href="#3.b."><font color="black">Deploy the Shibboleth Package</font></a></li>
        <li><a href="#3.c."><font color="black">Configuring Apache 1.3.x</font></a></li>
        <li><a href="#3.d."><font color="black">Configuring IIS</font></a></li>
        <li><a href="#3.e."><font color="black">Running the SHAR on Windows</font></a></li>
    </ol>
    </li>
    <li>
    <h4><a href="#4."><font color="black">Getting Running</font></a></h4>
    <ol type="a">
        <li><a href="#4.a."><font color="black">Configuring <span class="fixed">
        shibboleth.xml</span></font></a></li>
        <li><a href="#4.b."><font color="black">Dynamic Error Page Generation</font></a></li>
        <li><a href="#4.c."><font color="black">Key Generation and Certificate 
        Installation</font></a></li>
        <li><a href="#4.d."><font color="black">Protecting Web Pages</font></a></li>
        <li><a href="#4.e."><font color="black">Defining Attributes and 
        Acceptance Policies</font></a></li>
        <li><a href="#4.f."><font color="black">Using Attributes in Applications</font></a></li>
        <li><a href="#4.g."><font color="black"><span class="fixed">siterefresh</span></font></a></li>
        <li><a href="#4.h."><font color="black">MySQL Session Cache</font></a></li>
    </ol>
    </li>
    <li>
    <h4><a href="#5."><font color="black">Troubleshooting</font></a></h4>
    <ol type="a">
        <li><a href="#5.a."><font color="black">Basic Testing</font></a></li>
        <li><a href="#5.b."><font color="black">Common Problems</font></a></li>
    </ol>
    </li>
</ol>
<p><br>
</p>
<hr>
<p><br>
</p>
<h3><a name="1."></a>1. Shibboleth Overview</h3>
<p>Shibboleth is a system designed to exchange attributes across realms for the 
primary purpose of authorization. It provides a secure framework for one 
organization to transmit attributes about a web-browsing individual across 
security domains to another institution. In the primary usage case, when a user 
attempts to access a resource at a remote domain, the user&#39;s own home security 
domain can send certain information about that user to the target site in a 
trusted exchange. These attributes can then be used by the resource to help 
determine whether to grant the user access to the resource. The user may have 
the ability to decide whether to release specific attributes to certain sites by 
specifying personal Attribute Release Policies (ARP&#39;s), effectively preserving 
privacy while still granting access based on trusted information.</p>
<p>When a user first tries to access a resource protected by Shibboleth, they 
are redirected to a service which asks the user to specify the organization from 
which they want to authenticate. If the user has not yet locally authenticated 
to a WebISO service, the user will then be redirected to their home 
institution&#39;s authentication system. After the user authenticates, the 
Shibboleth components at the local institution will generate a temporary 
reference to the user, known as a handle, for the individual and send this to 
the target site. The target site can then use the handle to ask for attributes 
about this individual. Based on these attributes, the target can decide whether 
or not to grant access to the resource. The user may then be allowed to access 
the requested materials.</p>
<p>There are several controls on privacy in Shibboleth, and mechanisms are 
provided to allow users to determine exactly which information about them is 
released. A user&#39;s actual identity isn&#39;t necessary for many access control 
decisions, so privacy often is needlessly compromised. Instead, the resource 
often utilizes other attributes such as faculty member or member of a certain 
class. While these are commonly determined using the identity of the user, 
Shibboleth provides a way to mutually refer to the same principal without 
revealing that principal&#39;s identity. Because the user is initially known to the 
target site only by a randomly generated temporary handle, if sufficient, the 
target site might know no more about the user than that the user is a member of 
the origin organization. This handle should never be used to decide whether or 
not to grant access, and is intended only as a temporary reference for 
requesting attributes.</p>
<h4><a name="1.a."></a>1.a. Origin</h4>
<blockquote>
    <p>There are four primary components to the origin side in Shibboleth: the 
    Attribute Authority (AA), the Handle Service (HS), the directory service, 
    and the local sign-on system (SSO). The AA and HS are provided with 
    Shibboleth, and an open-source WebISO solution Pubcookie is also supplied; 
    the directory is provided by the origin site. Shibboleth is able to 
    interface with a directory exporting an LDAP interface or a SQL database 
    containing user attributes, and is designed such that programming interfaces 
    to other repositories should be readily implemented. Shibboleth relies on 
    standard web server mechanisms to trigger local authentication. A .htaccess 
    file can be easily used to trigger either the local WebISO system or the web 
    server&#39;s own Basic Auth mechanism, which will likely utilize an enterprise 
    authentication system, such as Kerberos.</p>
    <p>From the origin site&#39;s point of view, the first contact will be the 
    redirection of a user to the handle service, which will then consult the SSO 
    system to determine whether the user has already been authenticated. If not, 
    then the browser user will be asked to authenticate, and then sent back to 
    the target URL with a handle bundled in an attribute assertion. Next, a 
    request from the Shibboleth Attribute Requester (SHAR) will arrive at the AA 
    which will include the previously mentioned handle. The AA then consults the 
    ARP&#39;s for the directory entry corresponding to the handle, queries the 
    directory for these attributes, and releases to the SHAR all attributes the 
    SHAR is entitled to know about that user.</p>
</blockquote>
<h4><a name="1.b."></a>1.b. Target</h4>
<blockquote>
    <p>There are three primary components to the target side in Shibboleth: the 
    Shibboleth Indexical Reference Establisher (SHIRE), the Shibboleth Attribute 
    Requester (SHAR), and the resource manager (RM). An implementation of each 
    of these is included in the standard Shibboleth distribution. These 
    components are intended to run on the same web server.</p>
    <p>From the target&#39;s point of view, a browser will hit the RM with a request 
    for a Shibboleth-protected resource. The RM then allows the SHIRE to step 
    in, which will use the WAYF to acquire the name of a handle service to ask 
    about the user. The handle service (HS) will then reply with a SAML 
    authentication assertion containing a handle, which the SHIRE then hands off 
    to the SHAR. The SHAR uses the handle and the supplied address of the 
    corresponding attribute authority (AA) to request all attributes it is 
    allowed to know about the handle. The SHAR performs some basic validation 
    and analysis based on attribute acceptance policies (AAP&#39;s). These 
    attributes are then handed off to the RM, which is responsible for using 
    these attributes to decide whether to grant access.</p>
</blockquote>
<h4><a name="1.c."></a>1.c. Where are you from? (WAYF)</h4>
<blockquote>
    <p>The WAYF service can be either outsourced and operated by a federation or 
    deployed as part of the SHIRE. It is responsible for allowing a user to 
    associate themself with an institution of their specification, then 
    redirecting the user to the known address for the handle service of that 
    institution.</p>
</blockquote>
<h4><a name="1.d."></a>1.d. Federations</h4>
<blockquote>
    <p>A federation is one way to provide part of the underlying trust required 
    for function of the Shibboleth architecture. A federation in the context of 
    Shibboleth is a group of organizations(universities, corporations, content 
    providers, etc.) who agree to exchange attributes using the SAML/Shibboleth 
    protocols and abide by a common set of policies and practices. In so doing, 
    they must implicitly or explicitly agree to a common set of guidelines. 
    Joining a federation is not explicitly necessary for operation of 
    Shibboleth, but it dramatically expands the number of targets and origins 
    that can interact without defining bilateral agreements between all these 
    parties.</p>
    <p>A federation can be created in a variety of formats and trust models, but 
    to support Shibboleth, it must provide a certain set of services to 
    federation members. It needs to supply a registry to process applications to 
    the federation and distribute membership information to the origin and 
    target sites. This must include distribution of the PKI components necessary 
    for trust between origins and targets. There also needs to be a set of 
    agreements and best practices defined by the federation governing the 
    exchange, use, and population of attributes before and after transit, and 
    there should be a way to find information on local authentication and 
    authorization practices for federation members.</p>
</blockquote>
<hr>
<h3><a name="2."></a>2. Planning</h3>
<p>There are several essential elements that must be present in the environment 
to ensure Shibboleth functions well, both political and technical. Shibboleth 
currently runs on a specific range of platforms and web server environments. The 
SHAR and SHIRE are implemented entirely in C/C++. These are the recommendations 
and requirements for a successful implementation of a Shibboleth target.</p>
<h4><a name="2.a."></a>2.a. Requirements</h4>
<blockquote>
    <p>Shibboleth currently supports Windows NT/2000/XP/2003, Linux, and 
    Solaris. At present, Shibboleth consists of Apache (or IIS) plugins and a 
    separate SHAR process. The plugins use the Sun/ONC RPC mechanism to communicate 
    with the SHAR over Unix domain or TCP sockets. The target&#39;s web servers must 
    be running <a href="http://http://www.apache.org/dist/httpd/">Apache</a> 
    1.3+, 2.0+, or Microsoft IIS 4.0+ More precise technical 
    details are discussed in <a href="#3.a.">3.a</a>.</p>
</blockquote>
<h4><a name="2.b."></a>2.b. Join a Federation</h4>
<blockquote>
    <p>While it is not necessary for a target or origin to join a federation, 
    doing so greatly facilitates the implementation of multilateral trust 
    relationships. Each federation will have a different application process.</p>
    <p>For more information on federations, refer to <a href="#1.d.">1.d</a> or 
    the Shibboleth v1.0 architectural document.</p>
    <p>For testing in a private environment, Shibboleth comes with a default
    configuration that demonstrates how to implement a local peered agreement
    and supports testing both origin and target on the same box using localhost
    URLs. The sample key and certificate is for ease of testing only, and should
    always be replaced for real world use.</p>
</blockquote>
<h4><a name="2.c."></a>2.c. Security Considerations</h4>
<blockquote>
    <p>Shibboleth&#39;s protocols and software have been extensively engineered to 
    provide protection against many attacks. However, the most secure protocol 
    can be compromised if it is placed in an insecure environment. To ensure 
    Shibboleth is as secure as possible, there are several recommended security 
    precautions which should be in place at local sites.</p>
    <ol type="i">
        <li>SSL use is optional for target sites, but should be used if at all 
        possible, at least in the processing of incoming sessions (called the 
        SHIRE URL or assertion consumer service). Federation guidelines should 
        be considered when determining whether to implement SSL, and, in 
        general, SSL should be used for interactions with client machines to 
        provide the necessary authentication and encryption to ensure protection 
        from man-in-the-middle attacks. It is strongly suggested that all 
        password traffic or similarly sensitive data should be SSL-protected. 
        Assessment of the risk tradeoff against possible performance degradation 
        should be performed for all applications.</li>
        <li>Many other attacks can be made on the several redirection steps that 
        Shibboleth takes to complete attribute transfer. The best protection 
        against this is safeguarding the WAYF service and ensuring that rogue 
        targets and origins are not used, generally by development of the trust 
        model underneath Shibboleth. Shibboleth also leverages DNS for security, 
        which is not uncommon, but attacks concerning domain name lookups
        should be considered.</li>
        <li>Information regarding origin users is generally provided by the 
        authoritative enterprise directory, and the acceptance of requests from 
        target applications can be carefully restricted to ensure that all 
        requests the SHAR performs are authorized and all information the origin 
        provides is accurate. Use of plaintext passwords is strongly advised 
        against.</li>
        <li>Server platforms should be properly secured, commensurate with the 
        level that would be expected for an organization&#39;s other security 
        services, and cookie stores on client machines should be well protected.</li>
    </ol>
</blockquote>
<h4><a name="2.d."></a>2.d. Server Certs</h4>
<blockquote>
    <p>In the Shibboleth architecture, the SHAR, HS, and AA must all have 
    various client and/or server certificates for use in signing assertions and 
    creating SSL channels. These should be issued by a commonly accepted CA, 
    which may be stipulated by your federation. After understanding the CA&#39;s 
    acceptible to your federations, consult chapter <a href="#4.c.">4.c</a> for 
    information on certificate and key generation.</p>
</blockquote>
<h4><a name="2.e."></a>2.e. Attribute Release Policies</h4>
<blockquote>
    <p>The Attribute Authority maintains a set of rules called Attribute Release 
    Policies (ARP&#39;s) that define which attributes are released to which targets. 
    When a browser user tries to access a resource, the SHAR asks the origin 
    site AA to release all the attributes it is allowed to know, possibly 
    restricted to a specifically desired subset. The SHAR provides a client
    certificate with its request (assuming SSL is used) so the AA can further
    refine the information the SHAR is allowed to know. The AA 
    processes this request using all applicable ARP&#39;s, determines which 
    attributes and values it will release, and then obtains the values actually 
    associated with the browser user. The AA sends these attributes and values 
    back to the SHAR.</p>
    <p>Targets should work together with expected origin sites to ensure that 
    the sets of attributes that both sites expect to correspond using are 
    congruent.</p>
</blockquote>
<h4><a name="2.f."></a>2.f. Attribute Acceptance Policies</h4>
<blockquote>
    <p>When a target receives a set of attributes, it must evaluate them in the 
    context of the Attribute Authority that is providing them, to assess their 
    &quot;reasonableness&quot;. For example, if the value of an attribute is expected to 
    be from a small set of enumerated choices, the value should be compared 
    against that list. If a particular attribute or value is only trusted when 
    asserted by specific origins, that too should be checked.</p>
    <p>Targets are configured to accept specific attributes that they understand 
    and care about, and are also configured with the rules to apply before 
    accepting the attributes for use by the RM or an application. Attributes and 
    values that don&#39;t meet the target&#39;s requirements are filtered out. The set 
    of configuration rules to make these decisions is called an Attribute 
    Acceptance Policy (AAP).</p>
</blockquote>
<h4><a name="2.g."></a>2.g. Browser Requirements</h4>
<blockquote>
    <p>A primary Shibboleth design consideration was to require very little or 
    no modification to client machines. The only requirement is that a browser 
    is used which supports cookies, redirection and SSL. Browser users will have 
    to perform an additional click to submit the authentication assertion if 
    JavaScript is not functional.</p>
</blockquote>
<h4><a name="2.h."></a>2.h. Clocks</h4>
<blockquote>
    <p><a href="http://www.eecis.udel.edu/~ntp/">NTP</a> should be run on all 
    web servers. Shibboleth employs a short assertion acceptance window to protect 
    against replay attacks. Because of this, any significant degree of clock 
    skew can hinder the ability of users to access sites successfully.</p>
</blockquote>
<h4><a name="2.h."></a>2.i. Other Considerations</h4>
<blockquote>
    <p>Especially for higher education, there are a handful of laws enacted 
    which may have important ramifications on the disclosure of personal 
    information and attributes. Since Shibboleth does not necessarily need to 
    transmit identity, it is an ideal solution for many higher education 
    situations. Nevertheless, all parties within the United States of America 
    are strongly advised to consult the
    <a href="http://www.ed.gov/offices/OM/fpco/ferpa/">Family Educational Rights 
    and Privacy Act of 1974(FERPA)</a>, and all other relevant state and federal 
    legislation before deploying Shibboleth.</p>
</blockquote>
<p><br>
</p>
<hr>
<h3><a name="3."></a>3. Installation</h3>
<h4><a name="3.a."></a>3.a. Software Requirements</h4>
<p>The Shibboleth project makes binary packages available only for Windows,
that are precompiled against recent releases of various required libraries such 
as OpenSSL. Binaries for other platforms may be available on a limited or ad hoc
basis. It is highly advisable to build from source when using Shibboleth in 
a production environment in order to permit patching or updating of packages as 
security holes and bugs are fixed. Building from source is necessary to give you 
complete control over your deployment platform. The binary packages represent a 
snapshot in time only. To build from source, see the <span class="fixed">
INSTALL.txt</span> files in the doc folder of the OpenSAML and Shibboleth source 
distributions.</p>
<p>The software requirements listed correspond to the binary distribution. In 
general, source builds should work against all recent versions of the operating 
systems and software dependencies listed below. For specific questions, inquire 
to the support mailing list, or give it a try. Note that OpenSSL releases 
frequent security updates; the version listed may not be the most current, but 
most minor &quot;letter&quot; updates should be usable.</p>
<blockquote>
    <p><b>General Requirements and Notes:</b></p>
    <ul type="circle">
        <li><a href="http://www.apache.org/dist/httpd/">Apache 1.3.x</a>
        <blockquote>
            <p>Apache 1.3.x must be compiled with mod_so for DSO module support, and
            should include SSL support (preferably using <span class="fixed">mod_ssl</span>),
            and EAPI support (which <span class="fixed">mod_ssl</span> requires and provides).</p>
            <p><b>Portions of the <span class="fixed">libphp4</span> Apache 
            module are written in C++, as is Shibboleth. There is a known 
            conflict between the PHP extensions <span class="fixed">libpspell.so</span> 
            and <span class="fixed">libsablot.so</span> which will manifest 
            itself as segmentation faults when starting Apache. If a site wants 
            to use <span class="fixed">libphp4.so</span> and Shibboleth at the same time, 
            then one of the following may be done:</b>
            <ol>
                <li>Remove the options <span class="fixed">--with-pspell</span> 
                and <span class="fixed">--with-xslt-sablot</span> from PHP&#39;s 
                configuration.</li>
                <li>Rebuild these two modules using the same version of GCC that 
                was used to compile Shibboleth.</li>
            </ol>
            </p>
        </li>
        <li><a href="http://www.apache.org/dist/httpd/">Apache 2.0.x</a>
        <blockquote>
            <p>Apache 2.0.x must be compiled with mod_so for DSO module support, and
            should include SSL support which is available but not included by default.
            See also the note about PHP above.</p>
            <p>At the time of writing, an incompatibility exists between Shibboleth
            and <span class="fixed">mod_cgi</span> that causes forked CGI child processes
            to fail. The newer <span class="fixed">mod_cgid</span> provided for use with
            the multi-threaded worker MPM works fine and is suggested as a work-around
            even if running in prefork mode.</p>
        </blockquote>
        </li>
        <li>IIS 4.0+
            <blockquote>
            <p>When installing under Windows 2003, if the server is not in a
            domain before installing IIS 6, there may be issues surrounding
            permissions on directories because of new restrictions on IIS
            extensions accessing files.</p>
            </blockquote>
        </li>
        <li><a href="http://www.openssl.org">OpenSSL</a>
        <blockquote>
            <p>Verions 0.9.6 and 0.9.7 are both supported, but 0.9.7 should be used
            if possible, as support for 0.9.6 may be dropped in a future release.
            Support for threads and shared libraries <b>must</b> be included during
            configuration using the <i>threads</i> and <i>shared</i> options.</p>
        </blockquote>
        </li>
        <p>Most other required libraries are either easy to update or not found
        on typical systems. See the <span class="fixed">INSTALL.txt</span> files
        in the OpenSAML and Shibboleth source distributions for specific requirements
        of a given release. The important requirements are for pthreads support and
        shared libraries on Unix platforms. Without both, building will be hard and
        stability unlikely.</p>
    </ul>
    <p><b>Operating System Specific Notes:</b></p>
    <ul type="circle">
        <li>Windows NT/2000/XP/2003
            <ul type="disc">
                <li>
                <p>Any Apache modules used, and Apache itself, must be compiled 
                with the Microsoft DLL-based runtime, selected by compiling with 
                the /MD switch.</p>
                </li>
                <li>
                <p>The installer will prompt for an install path, change default 
                configuration files as appropriate for Windows, and set various 
                environment variables for you. A default SHAR service can also 
                be installed, or you can install it manually using the 
                instructions in this guide.</p>
                <p>Note that debug/symbol versions of the libraries and software 
                are included, and may be used by appending &quot;debug&quot; to the 
                Shibboleth library path and using the corresponding modules and 
                binaries. If you do so, be aware that Apache and other modules 
                must also be compiled with Microsoft&#39;s debug runtime (via the /MDd 
                compiler option). In most cases, you can safely ignore or even 
                delete the debug versions.</p>
                </li>
            </ul>
        </li>
        <li>RedHat Linux 7.2,7.3:
            <ul type="disc">
            <li>
                <p>The most recent Red Hat RPM (1.3.27-2 as of this writing) is sufficient for
                use with Shibboleth. You can use the older version of OpenSSL included, for this
                release, but be advised this may change in the future.</p>
            </li>
            <li>
                <p>The version of GCC that comes with this system is too old to build Shibboleth.
                Special update RPMs are available for GCC 3.04 that will work provided you
                configure packages with CC and CXX set to gcc3 and g++3 respectively. Newer
                GCC versions also work but may require a glibc upgrade and necessitate a lot
                of unrelated package updates.</p>
            </li>
            </ul>
        </li>
        <li>RedHat Linux 9 / Fedora
            <ul type="disc">
            <li>
                <p>Apache 2.0 is included as the default version in this release. If using
                the prefork MPM (<span class="fixed">/sbin/httpd</span>), then the Apache configuration
                file needs to be modified to use <span class="fixed">mod_cgid</span> in place of
                <span class="fixed">mod_cgi</span>. If using the worker MPM
                (<span class="fixed">/sbin/httpd.worker</span>), then <span class="fixed">mod_cgid</span>
                is used already, which Apache strongly recommends.</p>
            </li>
            </ul>
        </li>
        <li>RedHat Enterprise Linux
            <ul type="disc">
            <li>
                <p>Apache 2.0 is included as the default version in this release. Unlike
                the RH 9 and Fedora distributions, <span class="fixed">mod_cgid</span> is not
                included, which not only causes problems for Shibboleth but is also suboptimal
                if the worker MPM is used. No workaround is known yet, save building
                <span class="fixed">mod_cgid</span> from the Apache source.</p>
            </li>
            </ul>
        </li>
        <li>Debian Linux
            <ul type="disc">
            <li>
                <p>Shibboleth requires that Apache and Apache-SSL be built with
                <span class="fixed">libpthread</span>, or loading the
                <span class="fixed">mod_shib_13</span> or <span class="fixed">mod_shib_20</span>
                modules will cause Apache to fail. While RedHat&#39;s Apache is compatible,
                Debian&#39;s Apache must be rebuilt with <span class="fixed">libpthread</span>:</p>
                <blockquote>
                    <p><span class="fixed">$ export LDFLAGS=-lpthread<br>
                    $ apt-build --rebuild --reinstall install \<br>
&nbsp;&nbsp;&nbsp; apache-common apache apache-ssl</span></p>
                </blockquote>
            </li>
            </ul>
        </li>
        <li>Solaris 2.6+:
            <ul type="disc">
            <li>
                <p>The shared library version of OpenSSL is required by 
                Shibboleth. The static libraries may be installed as well if 
                necessary for other applications, but cannot be used within 
                mod_ssl or any other Apache modules. If mod_ssl's libssl.so
                module is linked against the static version, bus errors will
                result.</p>
                <p>To check how mod_ssl was built, run the <span class="fixed">
                ldd</span> command against <span class="fixed">libssl.so</span> 
                in the Apache <span class="fixed">libexec/</span> folder and 
                check the output for references to <span class="fixed">
                libssl.so.0.9.7</span>. If you see an earlier version 
                mentioned, or no mention of it at all, then OpenSSL 0.9.7 must be
                built with shared libraries from source, and the Apache module rebuilt with it.</p>
                <p>openssl-0.9.7d, the latest security fix release, has been tested,
                but any 0.9.7 version should work.</p>
            </li>
            <li>
                <p>Solaris does not come with GCC 3, but various versions can be obtained
                from <a href="http://www.sunfreeware.com">http://www.sunfreeware.com</a>.
                If building your own, GCC must be configured to use Sun's linker. Note that
                you should use a consistent version of GCC across any other C++ libraries
                in use within Apache, but other C++ code can freely use a different version
                as long as the necessary <span class="fixed">libstdc++.so</span> for a given
                version is available</p>
            </li>
            <li>
                <p>Use of GCC is recommended, but new releases of Sun's Forte compiler have
                been used successfully with some tinkering with configuration scripts.</p>
            </li>
        </ul>
        </li>
    </ul>
</blockquote>
<h4><a name="3.b."></a>3.b. Deploy the Shibboleth Package</h4>
<blockquote>
    <p>For the sake of clarity, this deployment guide assumes that standard 
    directories are used for all installations. These directories may be changed 
    for local implementations, but must be done so consistently.</p>
    <p>On Unix, the build documentation suggests building into
    <span class="fixed">/opt/shibboleth</span>. If you use a different layout or
    location, most of the essential configuration files will be tweaked for you,
    but watch for any exceptions.</p>
    <p>On Windows, use of the installer is recommended. Visual Studio 6.0
    project files are included with the OpenSAML and Shibboleth source
    distributions for source builds if maximum flexibility to deal with
    security issues is desired.</p>
</blockquote>
<h4><a name="3.c."></a>3.c. Configure Apache</h4>
<blockquote>
    <ol type="1">
        <li>Shibboleth includes configuration directives in the files
        <span class="fixed">/opt/shibboleth/etc/shibboleth/apache.config</span> 
        and <span class="fixed">/opt/shibboleth/etc/shibboleth/apache2.config</span>
        which must be added to the <span class="fixed">httpd.conf</span> file used
        locally. It is recommended that these directives simply be added to the end of the 
        existing <span class="fixed">httpd.conf</span> file rather than trying 
        to merge it in-line; <a href="#3.c.2.">step 2</a> describes the 
        necessary modifications to the Apache startup script. The default 
        configuration will often work, but if customization is necessary, these 
        options may be modified:<dl>
            <dd class="attribute"><span class="fixed">LoadModule &lt;module&gt; &lt;pathname&gt;</span></dd>
            <dd class="value">Specifies the name and location of the module,
            installed by default at <span class="fixed">/opt/shibboleth/libexec/mod_shib_13.so</span>
            or <span class="fixed">/opt/shibboleth/libexec/mod_shib_20.so</span></dd>
            
            <dd class="attribute"><span class="fixed">ShibConfig &lt;pathname&gt;</span></dd>
            <dd class="value">Specifies the <span class="fixed">pathname</span> 
            of the Shibboleth configuration file. Defaults to <span class="fixed">
            /opt/shibboleth/etc/shibboleth/shibboleth.xml</span>.</dd>
            
            <dd class="attribute"><span class="fixed">ShibSchemaDir &lt;path&gt;</span></dd>
            <dd class="value">Specifies the <span class="fixed">path</span> 
            of the Shibboleth schema folder. Defaults to <span class="fixed">
            /opt/shibboleth/etc/shibboleth</span>.</dd>
            
            <dd class="attribute"><span class="fixed">&lt;Location <i>url</i>&gt;<br>
            &nbsp;&nbsp;SetHandler &lt;method&gt;<br>
            &lt;/Location&gt;</span></dd>
            <dd class="value"><p>(Apache 1.3 only) Specifies the relative <span class="fixed">path</span>
            and the <span class="fixed">handler</span> the target uses to process 
            incoming sessions and lazy session startup for Shibboleth-protected
            resources. This works in concert with the <span class="fixed">shireURL</span>
            settings in the XML configuration file. Any virtual locations that are to be
            used for this purpose should be defined to Apache here.</p></dd>
        </dl>
        </li>
        <li>If the OpenSSL libraries are not in the system&#39;s search path, they 
        should be added to the <span class="fixed">LD_LIBRARY_PATH</span> used by
        Apache. Generally libtool&#39;s linker options will insure that the modules
        can locate the Shibboleth libraries, but if not, you may need to add
        <span class="fixed">/opt/shibboleth/lib</span> to <span class="fixed">
        LD_LIBRARY_PATH</span> as well.</li>
        <li>The SHAR must be started along with Apache. Among other methods on 
        Unix, this can be done either by creating a separate SHAR startup script 
        or by modifying Apache&#39;s RC script to start/stop the <span class="fixed">
        SHAR</span> <b>before</b> <span class="fixed">httpd</span>. It is 
        suggested that Apache&#39;s script be modified by adding:<blockquote>
            <p><span class="fixed">/opt/shibboleth/bin/shar -f &amp;</span> </p>
        </blockquote>
        <p>In most cases, the build process insures that the SHAR can locate
        the configuration file and schemas, but the SHIB_CONFIG and SHIB_SCHEMAS
        environment variables may be used as well. Command line options can also
        be used to specify them.</p>
        <p>On Windows, the SHAR is a service and is managed separately.</li>
        <li>By default, the Shibboleth modules are configured to log information 
        on behalf of Apache to the file <span class="fixed">
        /opt/shibboleth/var/log/shibboleth/shire.log</span>, though this can be 
        changed. For this log to be created, Apache must have permission to 
        write to this file, which may require that the file be manually created 
        and permissions assigned to whatever user Apache is configured to run 
        under. If the file does not appear when Apache runs with the modules 
        loaded, check for permission problems.</li>
        <li>The options in <span class="fixed">shibboleth.xml</span> must be 
        configured as documented in <a href="#4.a.">4.a</a>. Apache content may 
        then need to be modified for Shibboleth authentication. This is 
        discussed in <a href="#4.d.">4.d</a>. It is recommended that the target 
        then be tested as detailed in section <a href="#5.a.">5.a</a>.</li>
    </ol>
</blockquote>
<h4><a name="3.d."></a>3.d. Configure Microsoft IIS</h4>
<blockquote>
    <ol type="1">
        <li>The package includes an ISAPI filter and bundled extension for 
        session processing in a single library, <span class="fixed">libexec\isapi_shib.dll</span>. 
        This filter is configured using commands in <span class="fixed">
        C:\opt\shibboleth\etc\shibboleth\shibboleth.xml</span> (or wherever you've
        installed the software). Make sure you or the installer has added the lib
        directory to the path as directed in <a href="#3.b.">section 3.b.</a>
        <p>Installing the extension into IIS is a two step process:
        <ol type="1">
            <li type="a">First, add the filter using the Internet Services 
            Manager MMC console. Right click on the machine icon on the left, 
            and edit the WWW Service master properties. On the &quot;ISAPI Filters&quot; 
            tab, add a new filter called Shibboleth and specify the DLL named 
            above. The priority should be High, and once the filter is loaded, 
            make sure it appears in the list <b>below</b> the &quot;sspifilt&quot; entry. 
            Restart IIS and make sure the filter shows up with a green arrow. 
            Check the Windows event log if it fails to load.</li>
            <li type="a">Secondly, map a special file extension, such as
            <span class="fixed">.shire</span>, to the ISAPI library so that 
            virtual URLs can be specified to invoke the SHIRE handler for each 
            web site. Right click on the machine icon on the left, and edit the 
            WWW Service master properties. On the &quot;Home Directory&quot; tab, add a 
            script mapping using the &quot;Configuration&quot; button. The &quot;Executable&quot; 
            box should point to <span class="fixed">isapi_shib.dll</span>, and the 
            &quot;Extension&quot; can be set to anything unlikely to conflict, but
            <span class="fixed">.shire</span> is assumed (and the dot must be 
            included). You should NOT select the option to limit verbs, and 
            you MUST uncheck the &quot;Check that file exists&quot; box.</li>
            <li type="a"><font color=#444499>(IIS 6 Only)</font>  A new Web
            Service Extension must be defined for Shibboleth; without this, the
            mapping from <span class="fixed">*.shire</span> to <span
            class="fixed">isapi_shib.dll</span> won't occur and a file error
            will appear  Add this extension with an arbitrary name and associate
            it with <span class="fixed">isapi_shib.dll</span>.</li>
        </ol>
        </li>
        <li>All other aspects of configuration are handled via the
        <span class="fixed">shibboleth.xml</span> file and associated XML
        files described in subsequent sections. Particular use is made of 
        the <span class="fixed">/SHIRE/Implementation/ISAPI</span> element that allows the
        IIS sites to be mapped to fully-qualified hostnames for proper request mapping.</li>
        <li>Instance IDs are used in the IIS metabase to identify web sites. In older versions,
        they are applied starting with 1(one) and number the web sites in order in the
        Internet Services Manager from top to bottom. Newer versions appear to assign
        some IID values with strange ASCII formulas applied to the site name. A simple
        ASP or CGI script can be run within a site to dump the INSTANCE_ID header.</li>
        <li>See the following section for information on running the SHAR 
        service on Windows.</li>
        <li>The options in <span class="fixed">shibboleth.xml</span> must be 
        configured as documented in <a href="#4.a.">4.a</a>. It is recommended 
        that the target then be tested as detailed in section <a href="#5.a.">5.a</a>.</li>
    </ol>
</blockquote>
<h4><a name="3.e."></a>3.e. Running the SHAR on Windows</h4>
<blockquote>
    <p>The SHAR is a console application that is primarily designed to be 
    installed as a Windows service. To run the process in console mode for 
    testing or to diagnose major problems, the <span class="fixed">-console</span>
    parameter is used. Otherwise, parameters are used to install (or remove) the SHAR from the 
    service database and subsequent control is via the Service Control Manager 
    applet. The following command line parameters can be used:</p>
    <dl>
        <dd class="attribute"><span class="fixed">-console</span></dd>
        <dd class="value">Allows the process to be started from a command 
        prompt. Since the console will exit if the desktop user logs out, this 
        is not suitable for production use, but may be useful for testing.</dd>
        <dd class="attribute"><span class="fixed">-check</span></dd>
        <dd class="value">Validates the general correctness of the configuration.
        Not all problems can be detected this way, but the chance of successful startup
        is high if the checking process does not log any errors.</dd>
        <dd class="attribute"><span class="fixed">-config &lt;pathname&gt;</span> </dd>
        <dd class="value">Specifies the pathname of the SHAR&#39;s configuration 
        file. Defaults to <span class="fixed">\opt\shibboleth\etc\shibboleth\shibboleth.xml</span> 
        or the value of the <span class="fixed">SHIB_CONFIG</span> environment 
        variable, if it is set.</dd>
        <dd class="attribute"><span class="fixed">-schemadir &lt;path&gt;</span> </dd>
        <dd class="value">Specifies the path to the XML schema files. Defaults to
        <span class="fixed">\opt\shibboleth\etc\shibboleth</span> or the value of the
        <span class="fixed">SHIB_SCHEMAS</span> environment variable, if it is set.</dd>
        <dd class="attribute"><span class="fixed">-install &lt;servicename&gt;</span></dd>
        <dd class="value">Installs the SHAR as a named service in the Windows 
        service database. A name should be provided if multiple instances of the 
        SHAR need to be run on different ports, and thus installed separately. 
        The <span class="fixed">-config</span> option can be provided to include 
        a specific configuration file on the service&#39;s command line.</dd>
        <dd class="attribute"><span class="fixed">-remove &lt;servicename&gt;</span></dd>
        <dd class="value">Removes the named service instance of the SHAR from 
        the Windows service database.</dd>
    </dl>
    <h4><br>
    </h4>
</blockquote>
<hr>
<h3><a name="4."></a>4. Getting Running</h3>
<h4><a name="4.a."></a>4.a. Configuring <span class="fixed">shibboleth.xml</span></h4>
<blockquote>
	<p>The configuration for the target is mostly contained within <span class="fixed">shibboleth.xml</span>, located by default at <span class="fixed">\opt\shibboleth\etc\shibboleth\shibboleth.xml</span>.  The target comes pre-configured with certificates and settings that will work against a dummy origin; however, there are several values that must later be changed to interoperate with other sites securely and effectively.</p><p>The following is a hyperlinked version of a basic configuration file, followed by a list of elements and attributes that must be modified.  The actual example shipped with Shibboleth includes many more options that are commented out and other elements necessary to support dummy functionality.  Click on any attribute or element for more information on its population and definition.</p>

<blockquote><span class="fixed">
<a class="fixedlink" href="#confShibbolethTargetConfig">&lt;ShibbolethTargetConfig	xmlns=&quot;urn:mace:shibboleth:target:config:1.0&quot;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger=&quot;/opt/local/shibboleth-1.2/etc/shibboleth/shibboleth.logger&quot;&gt;</a>
<br>
<br>&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confExtensions">&lt;Extensions&gt;</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confLibrary">&lt;Library path=&quot;/opt/local/shibboleth-1.2/libexec/xmlproviders.so&quot; fatal=&quot;true&quot;/&gt;</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confExtensions">&lt;/Extensions&gt;</a>
<br>
<br>&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confSHAR">&lt;SHAR logger=&quot;/opt/local/shibboleth-1.2/etc/shibboleth/shar.logger&quot;&gt;</a>
<br>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confExtensions">&lt;Extensions&gt;</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confLibrary">&lt;Library path=&quot;/opt/local/shibboleth-1.2/libexec/shib-mysql-ccache.so&quot; fatal=&quot;false&quot;/&gt;</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confExtensions">&lt;/Extensions&gt;</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confUnixListener">&lt;UnixListener address=&quot;/tmp/shar-socket&quot;/&gt;</a>
<br>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- Primarily for IIS Deployments:
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confTCPListener">&lt;TCPListener address=&quot;127.0.0.1&quot; port=&quot;12345&quot; acl=&quot;127.0.0.1&quot;/&gt;</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confMemorySessionCache">&lt;MemorySessionCache cleanupInterval=&quot;300&quot; cacheTimeout=&quot;3600&quot; AATimeout=&quot;30&quot; AAConnectTimeout=&quot;15&quot;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;defaultLifetime=&quot;1800&quot; retryInterval=&quot;300&quot; strictValidity=&quot;true&quot; propagateErrors=&quot;false&quot;/&gt;</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
<br>&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confSHAR">&lt;/SHAR&gt;</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;
<br>&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confSHIRE">&lt;SHIRE logger=&quot;/opt/local/shibboleth-1.2/etc/shibboleth/shire.logger&quot;&gt;</a>
<br>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confRequestMapProvider">&lt;RequestMapProvider type=&quot;edu.internet2.middleware.shibboleth.target.provider.XMLRequestMap&quot;&gt;</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confRequestMap">&lt;RequestMap applicationId=&quot;default&quot;&gt;</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confHost">&lt;Host name=&quot;localhost&quot; scheme=&quot;https&quot;&gt;</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confPath">&lt;Path name=&quot;secure&quot; requireSession=&quot;true&quot; exportAssertion=&quot;true&quot;/&gt;</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confHost">&lt;/Host&gt;</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confHost">&lt;Host name=&quot;localhost&quot; scheme=&quot;http&quot;&gt;</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confPath">&lt;Path name=&quot;secure&quot; requireSession=&quot;true&quot; exportAssertion=&quot;true&quot;/&gt;</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confHost">&lt;/Host&gt;</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confRequestMap">&lt;/RequestMap&gt;</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confRequestMapProvider">&lt;/RequestMapProvider&gt;</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- IIS only:
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confImplementation">&lt;Implementation&gt;</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confISAPI">&lt;ISAPI normalizeRequest=&quot;true&quot;&gt;</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confSite">&lt;Site id=&quot;1&quot; host=&quot;localhost&quot;/&gt;</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confISAPI">&lt;/ISAPI&gt;</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confImplementation">&lt;/Implementation&gt;</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --&gt;
<br>&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confSHIRE">&lt;/SHIRE&gt;</a>
<br>
<br>&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confApplications">&lt;Applications xmlns:saml=&quot;urn:oasis:names:tc:SAML:1.0:assertion&quot;
<br>&nbsp;&nbsp;&nbsp;&nbsp;	applicationId=&quot;default&quot; providerId=&quot;https://localhost/shibboleth/target&quot;&gt;</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confSessions">&lt;Sessions lifetime=&quot;7200&quot; timeout=&quot;3600&quot; checkAddress=&quot;true&quot;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shireURL=&quot;/Shibboleth.shire&quot; shireSSL=&quot;false&quot; cookieName=&quot;shib-default-app&quot; cookieProps=&quot;; path=/&quot;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wayfURL=&quot;https://wayf.internet2.edu/InQueue/WAYF&quot;/&gt;</a>
<br>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confErrors">&lt;Errors shire=&quot;/opt/local/shibboleth-1.2/etc/shibboleth/shireError.html&quot;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rm=&quot;/opt/local/shibboleth-1.2/etc/shibboleth/rmError.html&quot;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;access=&quot;/opt/local/shibboleth-1.2/etc/shibboleth/accessError.html&quot;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;supportContact=&quot;root@localhost&quot;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logoLocation=&quot;/logo.gif&quot;/&gt;</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confPolicy">&lt;Policy signRequest=&quot;false&quot; signedResponse=&quot;false&quot; signedAssertions=&quot;false&quot;&gt;</a>

<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confAAPProvider">&lt;AAPProvider type=&quot;edu.internet2.middleware.shibboleth.target.provider.XMLAAP&quot; uri=&quot;/opt/local/shibboleth-1.2/etc/shibboleth/AAP.xml&quot;/&gt;</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confFederationProvider">&lt;FederationProvider type=&quot;edu.internet2.middleware.shibboleth.common.provider.XMLMetadata&quot;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uri=&quot;/opt/local/shibboleth-1.2/etc/shibboleth/sites.xml&quot;/&gt;</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confTrustProvider">&lt;TrustProvider type=&quot;edu.internet2.middleware.shibboleth.common.provider.XMLTrust&quot;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uri=&quot;/opt/local/shibboleth-1.2/etc/shibboleth/trust.xml&quot;/&gt;</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;saml:Audience&gt;urn:mace:inqueue&lt;/saml:Audience&gt;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confPolicy">&lt;/Policy&gt;</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confCredentialUse">&lt;CredentialUse TLS=&quot;defcreds&quot; Signing=&quot;defcreds&quot;&gt;</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confRelyingParty">&lt;RelyingParty Name=&quot;urn:mace:inqueue&quot; TLS=&quot;inqueuecreds&quot; Signing=&quot;inqueuecreds&quot;/&gt;</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confCredentialUse">&lt;/CredentialUse&gt;</a>
<br>
<br>&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confApplications">&lt;/Applications&gt;</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;
<br>&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confCredentialsProvider">&lt;CredentialsProvider type=&quot;edu.internet2.middleware.shibboleth.common.Credentials&quot;&gt;</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confCredentials">&lt;Credentials xmlns=&quot;urn:mace:shibboleth:credentials:1.0&quot;&gt;</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confFileResolver">&lt;FileResolver Id=&quot;defcreds&quot;&gt;</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confKey">&lt;Key format=&quot;PEM&quot;&gt;</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confPath">&lt;Path&gt;/opt/local/shibboleth-1.2/etc/shibboleth/shar.key&lt;/Path&gt;</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confKey">&lt;/Key&gt;</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confCertificate">&lt;Certificate format=&quot;PEM&quot;&gt;</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confPath">&lt;Path&gt;/opt/local/shibboleth-1.2/etc/shibboleth/shar.crt&lt;/Path&gt;</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confCertificate">&lt;/Certificate&gt;</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confFileResolver">&lt;/FileResolver&gt;</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confCredentials">&lt;/Credentials&gt;</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;<a class="fixedlink" href="#confCredentialsProvider">&lt;/CredentialsProvider&gt;</a>
<br>
<br><a class="fixedlink" href="#confShibbolethTargetConfig">&lt;/ShibbolethTargetConfig&gt;</a>
<br>
</span></blockquote>

<p>The following changes must be made to the default configuration before the target will interoperate in a federation.</p>
    <ol type="1">
        <li> 
        <p>The main <a href="#confApplications"><span class="fixed">Applications</span></a> element's <span class="fixed">providerId</span> attribute must be changed to reflect the URN this target will use to identify itself with its primary relying party.  This will often be supplied by a federation.</p>
		</li>
		<li>
		<p>The <span class="fixed">supportContact</span> for the target found in the <a href="#confErrors"><span class="fixed">Errors</span></a> element should be changed to ensure that users have a proper support mechanism.</p>
		</li>
		<li>
		<p>Proper credentials for this target signed by an authority that the primary relying party recognizes must be referenced by the <a href="#confCredentials"><span class="fixed">Credentials</span></a> element.  The default configuration points at flat files with widely-available, insecure keys and certificates.  Note that keys are supported in a variety of formats: DER, PEM, encrypted PEM, PKCS8, and encrypted PKCS8.  If a keystore must be used instead, consult <a href="#5.a.">section 5.a</a> for appropriate structure and details on population.</p>
        </li>
    </ol>

    <p>For Apache (but not IIS), there is also information that must be 
    configured in <span class="fixed">/usr/local/apache/conf/httpd.conf</span> 
    (or equivalent);&nbsp; for more information, refer to <a href="#3.c.2.">3.c</a>.</p>
    <p>Information in the logging configuration files referenced by
    <span class="fixed">shibboleth.xml</span> may require additional changes to 
    meet local needs. The logging level can be raised to <span class="fixed">
    INFO</span> or <span class="fixed">DEBUG</span> if additional detail is 
    needed for testing. It is recommended that after initial installation is 
    completed, the log level in both files be left at either <span class="fixed">
    INFO</span> or <span class="fixed">WARN</span>.</p>
    <p>All elements are optional unless otherwise specified.  All attributes of an element are optional unless designated <span class="mandatory">mandatory</span> by a purple background.</p>
        <dd class="attribute"><a name="confAAPProvider"><span class="fixed">&lt;AAPProvider type=&quot;edu.internet2.middleware.shibboleth.target.provider.XMLAAP&quot;   uri=&quot;<i>pathname</i>&quot;/&gt;</span></dd>
        <dd class="value">This element is used to specify individual attribute acceptance policies that will apply to this application and may appear one or more times within the <a href="#confAttributes"><span class="fixed">Attributes</span></a> element.  For information about these policies and their format, refer to <a href="#4.e.">section 4.e</a>.</dd>

<!-- Removed due to complexity

        <dd class="attribute"><a name="confApache"><span class="fixed">&lt;Apache apacheConfig=&quot;<i>true/false</i>&quot;/&gt;</span></dd>
        <dd class="value">Session configuration for Apache-based targets will be specified in <span class="fixed">httpd.conf</span> if <span class="fixed">true</span> or in <a href="#confRequestMap"><span class="fixed">RequestMap</span></a> elements if <span class="fixed">false</span>.</dd>

-->
        <dd class="attribute"><a name="confApplication"><span class="fixed">&lt;Application <span class="mandatory">id=&quot;<i>identifier</i>&quot;</span> providerId=&quot;<i>identifier</i>&quot;&gt;</span></dd>
        <dd class="value">Individual applications that require different attributes, credentials, sessions, etc. can be differentiated from the default configuration as specified in the <a href="#confApplications"><span class="fixed">Applications</span></a> element, which contains this element.  It must still contain a <a href="#confSessions"><span class="fixed">Sessions</span></a> element, but use of the <a href="#confErrors"><span class="fixed">Errors</span></a>, <a href="#confPolicy"><span class="fixed">Policy</span></a>, and <a href="#confCredentialUse"><span class="fixed">CredentialUse</span></a> elements is optional.
<ul>
<li class="mandatory"><span class="fixed">identifier</span>: This attribute defines an internal identifier allowing individual <span class="fixed">applicationId</span> attributes as part of <a href="#confRequestMap"><span class="fixed">RequestMap</span></a>, <a href="#confHost"><span class="fixed">Host</span></a>, and <a href="#confPath"><span class="fixed">Path</span></a> elements to point to this <span class="fixed">Application</span> to handle requests.</li>
<li><span class="fixed">providerId</span>: Separate from the internal identifier, the <span class="fixed">providerId</span> is the value that will be sent to the AA in attribute requests to allow the AA to differentiate applications on the target.  This value will often be provided to a federation to allow the origins to correctly release attributes to targets.  If none is specified, the default <a href="#confApplications><span class="fixed">Applications</span></a> <span class="fixed">providerId</span> will apply.</li>
</ul></dd>

        <dd class="attribute"><a name="confApplications"><span class="fixed">&lt;Applications id=&quot;<i>identifier</i>&quot; <span class="mandatory">providerId=&quot;<i>identifier</i>&quot;</span>&gt;</span></dd>
        <dd class="value">The <span class="fixed">Applications</span> element must appear once and contains default settings for requests handled by the target whose applicable request mapping using matching <a href="#confRequestMap"><span class="fixed">RequestMap</span></a>, <a href="#confHost"><span class="fixed">Host</span></a>, and <a href="#confPath"><span class="fixed">Path</span></a> elements has no declared <span class="fixed">applicationId</span> attribute.  It must contain at least one each of the <a href="#confSessions"><span class="fixed">Sessions</span></a>, <a href="#confErrors"><span class="fixed">Errors</span></a>, <a href="#confPolicy"><span class="fixed">Policy</span></a>, and <a href="#confCredentialUse"><span class="fixed">CredentialUse</span></a> elements, and may contain individual <a href="#confApplication"><span class="fixed">Application</span></a> elements.  Contained by the main <a href="#confShibbolethTargetConfig"><span class="fixed">ShibbolethTargetConfig</span></a> element.
<ul>
<li><span class="fixed">identifier</span>: This attribute defines an internal identifier allowing individual <span class="fixed">applicationId</span> attributes need to point to the main <span class="fixed">Applications</span> configuration as a handler by over-riding their container elements.</li>
<li class="mandatory"><span class="fixed">providerId</span>: Separate from the internal identifier, the <span class="fixed">providerId</span> is the value that will be sent to the AA in attribute requests to allow the AA to differentiate applications on the target.  This value will often be provided to a federation to allow the origins to correctly release attributes to targets.</li>
</ul></dd>

        <dd class="attribute"><a name="confAttributes"><span class="fixed">&lt;Attributes signRequest=&quot;<i>true/false</i>&quot; signedResponse=&quot;<i>true/false</i>&quot; signedAssertions=&quot;<i>true/false</i>&quot;&gt;</span></dd>
        <dd class="value">The <span class="fixed">Attributes</span> element affects how this application handles attribute queries to AA's and the processing of these attributes upon receipt.  It may contain one or more <a href="#confAAPProvider><span class="fixed">AAPProvider</span></a> elements, each of which specifies a set of attribute acceptance policies; see <a href="#4.e.">section 4.e</a> for details.
<ul>
<li><span class="fixed">signRequest</span>: If <span class="fixed">true</span>, the target will sign attribute requests that it sends to origins for requests for this application.  This is not always necessary, as the SSL session can provide authentication.</li>
<li><span class="fixed">signedResponse</span>: If this is <span class="fixed">true</span>, the target will require that all SAML attribute responses it receives for this application be signed.</li>
<li><span class="fixed">signedAssertions</span>: If this is <span class="fixed">true</span>, the target will require that individual SAML attribute assertions it receives for this application be signed.  This may be particularly useful if the application is exporting the assertion.</li>
</ul></dd>

        <dd class="attribute"><a name="confCAPath"><span class="fixed">&lt;CAPath&gt;<i>pathname</i>&lt;/CAPath&gt;</span></dd>
        <dd class="value">Paired with a <a href="#confPath"><span class="fixed">Path</span></a> element and contained by a <a href="#confFileResolver"><span class="fixed">FileResolver</span></a> element, this element allows for the specification of additional certificates in the chain up to the trust anchor.  As many <span class="fixed">CAPath</span> elements as necessary to complete the chain may be specified.  The expectations of the target and the federation may determine the necessity for the use of this field.</dd>

        <dd class="attribute"><a name="confCertAlias"><span class="fixed">&lt;CertAlias&gt;<i>string</i>&lt;/CertAlias&gt;</span></dd>
        <dd class="value">Specifies the alias for the certificate 
        corresponding to the private key used by the HS.  If no alias is specified, defaults to the private key's alias.  Contained by the <a href="#confKeyStoreResolver"><span class="fixed">KeyStoreResolver</span></a> element.</dd>

        <dd class="attribute"><a name="confCertificate"><span class="fixed">&lt;Certificate format=&quot;<i>type</i>&quot;&gt;</span></dd>
        <dd class="value">This specifies the certificate corresponding to this set of credentials.  The certificate itself must be referred to using a <a href="#confPath"><span class="fixed">Path</span></a> element contained by this element.  If this certificate isn't self-signed or signed by a root familiar to the origin, the files of certificates in the path to the root may be specified using one or more <a href="#confPath"><span class="fixed">CAPath</span></a> elements.  Valid encodings are <span class="fixed">PEM</span> and <span class="fixed">DER</span>.  It resides within the <a href="#confFileResolver"><span class="fixed">FileResolver</span> element and must be paired with the corresponding private key using the <a href="#confKey"><span class="fixed">Key</span></a> element.</dd>

        <dd class="attribute"><a name="confCredentials"><span class="fixed">&lt;Credentials xmlns=&quot;urn:mace:shibboleth:credentials:1.0&quot;&gt;</span></dd>
        <dd class="value">This element is the container for credentials used by the credential mechanism specified by the <a href="#confCredentialsProvider"><span class="fixed">CredentialsProvider</span></a> element.  For most deployments, the URN should be <span class="fixed"></span>.  It must contain one <a href="#confFileResolver"><span class="fixed">FileResolver</span></a> element for flat key and certificate files or one <a href="#confKeyStoreResolver"><span class="fixed">KeyStoreResolver</span></a> element for compound keystores.</dd>

        <dd class="attribute"><a name="confCredentialsProvider"><span class="fixed">&lt;CredentialsProvider type=&quot;edu.internet2.middleware.shibboleth.common.Credentials&quot;&gt;</span></dd>
        <dd class="value">This element is the container for credentials used by the target and is contained by the <a href="#confShibbolethTargetConfig"><span class="fixed">ShibbolethTargetConfig</span></a> element.  It must contain one <a href="#confCredentials"><span class="fixed">Credentials</span></a> element detailing the individual credentials to be used by the target in attribute transactions.</dd>

        <dd class="attribute"><a name="confErrors"><span class="fixed">&lt;Errors <span class="mandatory">shire=&quot;<i>pathname</i>&quot; rm=&quot;<i>pathname</i>&quot; access=&quot;<i>pathname</i>&quot; supportContact=&quot;<i>e-mail</i>&quot; logoLocation=&quot;<i>URL</i>&quot;</span>/&gt;</span></dd>
        <dd class="value">Shibboleth is capable of displaying customized error pages based on templates and special resources provided by these configuration attributes.  These should all be customized to fit the web scheme of the target.  For more information on configuration of the error page generation, please see <a href="#4.b.">section 4.b</a>.
<ul>
<li class="mandatory"><span class="fixed">shire</span>: Specifies the location of the template for the error page generated when there is an error re-directing the user to the WAYF or processing a new session sign-on.</li>
<li class="mandatory"><span class="fixed">rm</span>: Specifies the location of the template for the error page generated if internal errors occur in the RM.</li>
<li class="mandatory"><span class="fixed">accessError</span>: Specifies the location of the template for the page displayed to users when access to a protected resource is denied by the RM. This is distinct from when errors occur during the evaluation          process itself, and indicates a denial of authorization.</li>
<li class="mandatory"><span class="fixed">supportContact</span>: Specifies a support e-mail address for the user to contact.</li>
<li class="mandatory"><span class="fixed">logoLocation</span>: Specifies the location of the logo used in the generation of error pages. This logo can be in any format that the web browser will understand, and should be a URL (absolute or relative) that will return a valid logo.</li>
</ul></dd>

        <dd class="attribute"><a name="confExtensions"><span class="fixed">&lt;Extensions&gt;</span></dd>
        <dd class="value">Extension libraries for one of the Shibboleth components or the entire target can be specified using this element depending on where it's present.  It may be contained by any of the <a href="#confSHAR"><span class="fixed">SHAR</span></a>, <a href="#confSHIRE"><span class="fixed">SHIRE</span></a>, or <a href="#confShibbolethTargetConfig"><span class="fixed">ShibbolethTargetConfig</span></a> elements.  It should always contain one or more <a href="#confLibrary"><span class="fixed">Library</span></a> elements.</dd>

        <dd class="attribute"><a name="confFederationProvider"><span class="fixed">&lt;FederationProvider type=&quot;edu.internet2.middleware.shibboleth.common.provider.XMLMetadata&quot; uri=&quot;<i>pathname</i>&quot;/&gt;</span></dd>
        <dd class="value">This element, when specified within a <a href="#confPolicy"><span class="fixed">Policy</span></a> element, points to metadata in the form of a sites file for use by this application distributed by the federation under which it operates.  This should be updated regularly; see <a href="#4.g.">section 4.g</a> for further details.</dd>

        <dd class="attribute"><a name="confFileResolver"><span class="fixed">&lt;FileResolver Id=&quot;<i>string</i>&quot;&gt;</span></dd>
        <dd class="value">This element defines a pair of files used to store a private key and certificate associated with a given identifier and is contained by the <a href="#confCredentials"><span class="fixed">Credentials</span></a> element.  <a href="#confRelyingParty"><span class="fixed">RelyingParty</span></a> elements will refer to these identifiers allowing multiple resolver elements to be used to specify different credential storage for different applications.  It must contain one <a href="#confKey"><span class="fixed">Key</span></a> element and should contain one <a href="#confCertificate"><span class="fixed">Certificate</span></a> element.</dd>

        <dd class="attribute"><a name="confHost"><span class="fixed">&lt;Host scheme=&quot;<i>protocol</i>&quot; <span class="mandatory">name=&quot;<i>fqdn</i>&quot;</span> port=&quot;<i>integer</i>&quot; applicationId=&quot;<i>id</i>&quot; requireSession=&quot;<i>true/false</i>&quot; exportAssertion&gt;</span></dd>
        <dd class="value">Individual hosts that this target protects are enumerated by <span class="fixed">Host</span> elements as contained by <a href="#confRequestMap"><span class="fixed">RequestMap</span></a> element.  If a request is received by Shibboleth for a URL on this host, these parameters will be applied to the handling.  If there are <a href="#confPath"><span class="fixed">Path</span></a> elements within this element that match the URL and contain the <span class="fixed">applicationId</span>, <span class="fixed">requireSession</span>, or <span class="fixed">exportAssertion</span> attributes, they will over-ride the ones in this element; similarly, the ones within this element will over-ride the ones in the containing <a href="#confRequestMap"><span class="fixed">RequestMap</span></a> element.
<ul>
<li><span class="fixed">scheme</span>: This specifies the protocol that this host is responding to requests on.  Valid choices are <span class="fixed">http</span>, <span class="fixed">https</span>, <span class="fixed">ftp</span>, <span class="fixed">ldap</span>, and <span class="fixed">ldaps</span>.</li>
<li class="mandatory"><span class="fixed">name</span>: This is the domain name of the host that URL's will contain.  This appended to the <span class="fixed">scheme</span> must match what is contained in the URL for the request to be handled by this element.</li>
<li><span class="fixed">port</span>: This is the port the host is listening on, if it's not standard.</li>
<li><span class="fixed">requireSession</span>: This attribute controls whether the SHIRE will always establish a session before handing off to the application.  If <span class="fixed">true</span>, Shibboleth will force session establishment before this.  If <span class="fixed">false</span>, applications will be responsible for ensuring that sessions are generated if necessary, so-called <a href="#1.f.">lazy session establishment</a>.  Most deployments should not specify <span class="fixed">false</span> without a full understanding of the implications.</li>
<li><span class="fixed">exportAssertion</span>: When this boolean is <span class="fixed">true</span>, the entire SAML attribute assertion received by          the SHAR is exported to a CGI request header called <span class="fixed">Shib-Attributes</span>, encoded in <span class="fixed">base64</span>.  This requires an application to be able to parse the raw XML; however, it also permits an application to see attributes that may have been filtered by an AAP, or to forward the SAML assertion to a third party.  Defaults to <span class="fixed">false</span>, which most deployments should use.</li>
</ul></dd>

        <dd class="attribute"><a name="confImplementation"><span class="fixed">&lt;Implementation&gt;</span></dd>
        <dd class="value">A container element placed inside the <a href="#confSHIRE"><span class="fixed">SHIRE</span></a> element, the contents of this element will vary depending on the web server that this Shibboleth deployment serves.  Multiple configurations may be specified, but only one per web server type.  This element may contain the <a href="#confISAPI"><span class="fixed">ISAPI</span></a> element. <!--  NOT IMPLEMENTED: <a href="#confApache"><span class="fixed">Apache</span></a>, and <a href="#confNSAPI"><span class="fixed">NSAPI</span></a>, <a href="#confJava"><span class="fixed">Java</span></a> -->.</dd>

        <dd class="attribute"><a name="confISAPI"><span class="fixed">&lt;ISAPI normalizeRequest=&quot;<i>true/false</i>&quot;&gt;</span></dd>
        <dd class="value">The configuration information for Shibboleth targets deployed behind ISAPI is stored inside this container element.  This element must contain one or more <a href="#confSite"><span class="fixed">Site</span></a> elements, each of which maps IIS IID values to the vhost name.  If <span class="fixed">normalizeRequest</span> is <span class="fixed">true</span>, all redirects and computed request URLs generated by Shibboleth will be created using the virtual server name assigned to the server.  If <span class="fixed">false</span>, the browser's supplied URL is sometimes used to compute the information.  This sometimes has no effect, depending on the capabilities of the web server, since the correct behavior is almost always to rely on the server's API to report the hostname and ignore the browser.  Contained by the <a href="#confImplementation"><span class="fixed">Implementation</span></a> element.</dd>

        <dd class="attribute"><a name="confKey"><span class="fixed">&lt;Key format=&quot;<i>type</i>&quot;&gt;</span></dd>
        <dd class="value">This specifies the file containing a private key to be used by a set of credentials.  Valid encodings are <span class="fixed">PEM</span> and <span class="fixed">DER</span>.  Keys are supported in a variety of formats: DER, PEM, encrypted PEM, PKCS8, and encrypted PKCS8.  It resides within the <a href="#confFileResolver"><span class="fixed">FileResolver</span> element, should be paired with a <a href="#confCertificate"><span class="fixed">Certificate</span></a> element, and contain a <a href="#confPath"><span class="fixed">Path</span></a> element.</dd>

        <dd class="attribute"><a name="confKeyAlias"><span class="fixed">&lt;KeyAlias&gt;<i>string</i>&lt;/KeyAlias&gt;</span></dd>
        <dd class="value">Specifies the alias used for accessing the private 
        key.  Contained by the <a href="#confKeyStoreResolver"><span class="fixed">KeyStoreResolver</span></a> element.</dd>

        <dd class="attribute"><a name="confKeyPassword"><span class="fixed">&lt;KeyPassword&gt;<i>string</i>&lt;/KeyPassword&gt;</span></dd>
        <dd class="value">Specifies the password used to retrieve the private 
        key.  Contained by the <a href="#confKeyStoreResolver"><span class="fixed">KeyStoreResolver</span></a> element.</dd>

        <dd class="attribute"><a name="confKeyStoreKeyAlias"><span class="fixed">&lt;KeyStoreKeyAlias&gt;<i>string</i>&lt;/KeyStoreKeyAlias&gt;</span></dd>
        <dd class="value">Specifies the alias used for accessing the private 
        key.  Contained by the <a href="#confNameMapping"><span class="fixed">NameMapping</span></a> element when a <span class="fixed">CryptoHandleGenerator</span> type is specified.</dd>

        <dd class="attribute"><a name="confKeyStoreKeyPassword"><span class="fixed">&lt;KeyStoreKeyPassword&gt;<i>string</i>&lt;/KeyStoreKeyPassword&gt;</span></dd>
        <dd class="value">Specifies the password used to retrieve the private 
        key.  Contained by the <a href="#confNameMapping"><span class="fixed">NameMapping</span></a> element when a <span class="fixed">CryptoHandleGenerator</span> type is specified.</dd>

        <dd class="attribute"><a name="confKeyStorePassword"><span class="fixed">&lt;KeyStorePassword&gt;<i>string</i>&lt;/KeyStorePassword&gt;</span></dd>
        <dd class="value">Specifies the password to access the keystore containing the private key to be used for symmetric encryption.  Contained by the <a href="#confNameMapping"><span class="fixed">NameMapping</span></a> element when a <span class="fixed">CryptoHandleGenerator</span> type is specified.</dd>

        <dd class="attribute"><a name="confKeyStorePath"><span class="fixed">&lt;KeyStorePath&gt;<i>string</i>&lt;/KeyStorePath&gt;</span></dd>
        <dd class="value">Specifies the location of the keystore containing the private key to be used for symmetric encryption to pass handles between the HS and AA.  Contained by the <a href="#confNameMapping"><span class="fixed">NameMapping</span></a> element when a <span class="fixed">CryptoHandleGenerator</span> type is specified.</dd>

        <dd class="attribute"><a name="confKeyStoreResolver"><span class="fixed">&lt;KeyStoreResolver Id=&quot;<i>string</i>&quot; storeType=&quot;<i>type</i>&quot;&gt;</span></dd>
        <dd class="value">This element is contained by the <a href="#confCredentials"><span class="fixed">Credentials</span></a> element and to specify a keystore that contains both the certificate and private key for a given set of credentials.  Typically, this will be a Java keystore, with a corresponding type of <span class="fixed">JKS</span>.  <a href="#confRelyingParty"><span class="fixed">RelyingParty</span></a> elements will refer to the <span class="fixed">Id</span> allowing multiple resolver elements to be used to specify different credential storage for different federations or target sites.  It must contain one <a href="#confPath"><span class="fixed">Path</span></a> element, one <a href="#confKeyAlias"><span class="fixed">KeyAlias</span></a> element, and one <a href="#confStorePassword"><span class="fixed">StorePassword</span></a> element; it may optionally contain a <a href="#confKeyPassword"><span class="fixed">KeyPassword</span></a> element or a <a href="#confCertAlias"><span class="fixed">CertAlias</span></a> element.</dd>

        <dd class="attribute"><a name="confLibrary"><span class="fixed">&lt;Library <span class="mandatory">path=&quot;<i>pathname</i>&quot;</span> fatal=&quot;<i>true/false</i>&quot;/&gt;</span></dd>
        <dd class="value">This element defines an extension library for one of Shibboleth's components when specified within an <a href="#confExtensions"><span class="fixed">Extensions</span></a> element.
<ul><li class="mandatory"><span class="fixed">path</span>: This designates the complete pathname to where the library is.</li>
<li><span class="fixed">fatal</span>: If this boolean is set to <span class="fixed">true</span> and the library is not located or fails to load properly, the target will not start.</li>
</ul></dd>

        <dd class="attribute"><a name="confMemorySessionCache"><span class="fixed">&lt;MemorySessionCache <a href="#confSessionCacheProperties">sessionCacheProperties</a>/&gt;</span></dd>
        <dd class="value">Shibboleth will cache sessions and received attributes in-memory if this element is part of <span class="fixed">shibboleth.xml</span>.  There's actually a great number of attributes that may be specified; consult the <a href="#confSessionCacheProperties">sessionCacheAttributes</a> section for a full list and descriptions.  This element must be contained by the <a href="#confSHAR"><span class="fixed">SHAR</span></a> element and is mutually exclusive with the <a href="#confMemorySessionCache"><span class="fixed">MemorySessionCache</span></a> element.</dd>

        <dd class="attribute"><a name="confMySQLSessionCache"><span class="fixed">&lt;MySQLSessionCache mysqlTimeout=&quot;<i>seconds</i>&quot; <a href="#confSessionCacheProperties">sessionCacheProperties</a>/&gt;</span></dd>
        <dd class="value">Shibboleth will cache sessions and received attributes using a MySQL database if this element is part of <span class="fixed">shibboleth.xml</span>.  Arguments may be passed directly to MySQL by populating this element with additional <span class="fixed"><a href="#confArgument">Argument</a></span> elements.  There's actually a great number of attributes that may be specified; consult the <a href="#confSessionCacheProperties">sessionCacheAttributes</a> section for a full list and descriptions.  This element must be contained by the <a href="#confSHAR"><span class="fixed">SHAR</span></a> element and is mutually exclusive with the <a href="#confMemorySessionCache"><span class="fixed">MemorySessionCache</span></a> element.
<ul>
<li><span class="fixed">mysqlTimeout</span>: This specifies a duration in seconds that the target will wait before MySQL requests timeout.  Defaults to 14400.</li>
</ul></dd>

        <dd class="attribute"><a name="confPath"><span class="fixed">&lt;Path <span class="mandatory">name=&quot;<i>pathname</i>&quot;</span> applicationId=&quot;<i>id</i>&quot; requireSession=&quot;<i>true/false</i>&quot; exportAssertion/&gt;</span></dd>
        <dd class="value">This attribute allows for different application identifiers and session handling to be defined iteratively for subdirectories within a host.  Requests are processed on a best-match basis, with the innermost element taking precedence; for more information, consult blah.  Path elements may be contained by <a href="#confHost"><span class="fixed">Host</span></a> elements or other <a href="#confPath"><span class="fixed">Path</span></a> elements.
<ul>
<li class="mandatory"><span class="fixed">name</span>: This is the domain name of the host that URL's will contain.  This appended to the <span class="fixed">scheme</span> must match what is contained in the URL for the request to be handled by this element.</li>
<li><span class="fixed">requireSession</span>: This attribute controls whether the SHIRE will always establish a session before handing off to the application.  If <span class="fixed">true</span>, Shibboleth will force session establishment before this.  If <span class="fixed">false</span>, applications will be responsible for ensuring that sessions are generated if necessary, so-called <a href="#1.f.">lazy session establishment</a>.  Most deployments should not specify <span class="fixed">false</span> without a full understanding of the implications.</li>
<li><span class="fixed">exportAssertion</span>: When this boolean is <span class="fixed">true</span>, the entire SAML attribute assertion received by          the SHAR is exported to a CGI request header called <span class="fixed">Shib-Attributes</span>, encoded in <span class="fixed">base64</span>.  This requires an application to be able to parse the raw XML; however, it also permits an application to see attributes that may have been filtered by an AAP, or to forward the SAML assertion to a third party.  Defaults to <span class="fixed">false</span>, which most deployments should use.</li>
</ul></dd>

        <dd class="attribute"><a name="confPolicy"><span class="fixed">&lt;Policy&gt;</span></dd>
        <dd class="value">This element is the main container for specification of policies for attributes, trust, and federation handling by an application.  It must be contained by the <a href="#confApplications"><span class="fixed">Applications</span></a> and, if contained by an <a href="#confApplication"><span class="fixed">Application</span></a> element, will over-ride the main policy element which would have been inherited by default.  The configuration for policy is defined by these elements, each of which is optional: <a href="#confAttributes"><span class="fixed">Attributes</span></a>, <a href="#confFederationProvider"><span class="fixed">FederationProvider</span></a>, <a href="#confTrustProvider"><span class="fixed">TrustProvider</span></a>, <a href="#confRevocationProvider"><span class="fixed">RevocationProvider</span></a>, and <a href="#confAudiences"><span class="fixed">Audiences</span></a>.</dd>

        <dd class="attribute"><a name="confRequestMap"><span class="fixed">&lt;RequestMap applicationId=&quot;<i>id</i>&quot; requireSession=&quot;<i>true/false</i>&quot; exportAssertion=&quot;<i>true/false</i>&quot;
uri=&quot;<i>URI</i>&quot;&gt;</span></dd>
        <dd class="value"><p><b>For a general description of how the target handles incoming requests, please refer to <a href="#1.f.">section 1.f</a>.</b></p><p>Each <span class="fixed">RequestMap</span> element contains a set of hosts, URLs, and applications that all share the same rules on session and assertion requirements in the form of individual <a href="#confHost"><span class="fixed">Host</span></a> elements.  If session requirement or assertion handling conditions varies across that granularity, additional <span class="fixed">RequestMap</span> elements may be specified for them.  Alternatively, these conditions may be specified on <a href="#confPath"><span class="fixed">Path</span></a> and <a href="#confHost"><span class="fixed">Host</span></a> elements within this element which will override these settings.</p>
<ul>
<li><span class="fixed">applicationId</span>: If specified, then any queries handled by this request mapping will be considered part of the application <span class="fixed">id</span> as defined in an <a href="#confApplication"><span class="fixed">Application</span></a> element with the same identifier.  If no <span class="fixed">applicationId</span> is specified, then the default specified in the <a href="#confApplications"><span class="fixed">Applications</span></a> element will apply.</li>
<li><span class="fixed">requireSession</span>: This attribute controls whether the SHIRE will always establish a session before handing off to the application.  If <span class="fixed">true</span>, Shibboleth will force session establishment before this.  If <span class="fixed">false</span>, applications will be responsible for ensuring that sessions are generated if necessary, so-called <a href="#1.f.">lazy session establishment</a>.  Most deployments should not specify <span class="fixed">false</span> without a full understanding of the implications.</li>
<li><span class="fixed">exportAssertion</span>: When this boolean is <span class="fixed">true</span>, the entire SAML attribute assertion received by          the SHAR is exported to a CGI request header called <span class="fixed">Shib-Attributes</span>, encoded in <span class="fixed">base64</span>.  This requires an application to be able to parse the raw XML; however, it also permits an application to see attributes that may have been filtered by an AAP, or to forward the SAML assertion to a third party.  Defaults to <span class="fixed">false</span>, which most deployments should use.</li>
</ul></dd>
        <dd class="attribute"><a name="confRelyingParty"><span class="fixed">&lt;RelyingParty <span class="mandatory">name=&quot;<i>URN</i>&quot; TLS=&quot;<i>id</i> Signing=&quot;id&quot;/</span></span></dd>
        <dd class="value"><p>One or more <span class="fixed">RelyingParty</span> elements may be contained by individual <a href="#confCredentialUse"><span class="fixed">CredentialUse</span></a> elements to enumerate relying parties for which an individual set of credentials should be used.  Each one will contain a unique URN specified in transactions conducted with that relying party and may use different credentials for different aspects of the interaction with origins within that relying party.</p>
<ul>
<li class="mandatory"><span class="fixed">name</span>: This URN will be sent by the target to origins that are covered by this <span class="fixed">RelyingParty</span> definition.  This must match a value that is expected by the origin for proper trust and attribute release to occur.  If there is no direct match, the origin uses metadata to try to find a federation that this target is a member of.</li>
<li class="mandatory"><span class="fixed">TLS</span>: This specifies the <span class="fixedwidth">Id</span> of the <a href="#confFileResolver"><span class="fixedwidth">FileResolver</span></a> element pointing towards the credentials to be used to initiate the TLS connection over which the attribute request is made of origins within this relying party.</li>
<li class="mandatory"><span class="fixed">Signing</span>: This specifies the <span class="fixedwidth">Id</span> of the <a href="#confFileResolver"><span class="fixedwidth">FileResolver</span></a> element pointing towards the credentials to be used to sign the attribute request for origins within this relying party.</li>
</ul>
</dd>

        <dd class="attribute"><a name="confRequestMapProvider"><span class="fixed">&lt;RequestMapProvider type=&quot;edu.internet2.middleware.shibboleth.target.provider.XMLRequestMap&quot;&gt;</span></dd>
        <dd class="value"><p>This element holds one or more request mapping providers, each of which defines how Shibboleth will perform sessions and access controls for a given mapping of a URL to a path.  There must be one or more <a href="#confRequestMap"><span class="fixed">RequestMap</span></a> elements within this element, each of which represents access controls and session definitions for a URL to pathname mapping.</p><!-- Removed due to complexity:<p>Note that these mappings are only consulted by IIS deployments and Apache deployments where <span class="fixed">apacheConfig</span> in the <a href="#confApache"><span class="fixed">Apache</span></a> element is <span class="fixed">false</span>; otherwise, mappings and access controls are specified using <span class="fixed">httpd.conf</span>.</p>--></dd>

        <dd class="attribute"><a name="confSessions"><span class="fixed">&lt;Sessions <span class="mandatory">wayfURL=&quot;<i>URL</i>&quot;<br> 
shireURL=&quot;<i>URL</i>&quot;</span><br> 
shireSSL=&quot;<i>true/false</i>&quot;<br> 
<span class="mandatory">cookieName=&quot;<i>URL</i>&quot;</span><br> 
cookieProps=&quot;<i>URL</i>&quot;<br> 
lifetime=&quot;<i>seconds</i>&quot;<br> 
timeout=&quot;<i>seconds</i>&quot;<br> 
checkAddress=&quot;<i>true/false</i>&quot;<br>/&gt;</span></dd>
        <dd class="value">Configuration parameters that affect the way Shibboleth handles sessions for an individual application identifier are bundled in this element, which must be contained by each <a href="#confApplication"><span class="fixed">Application</span></a> and <a href="#confApplications"><span class="fixed">Applications</span></a> element.  Note that these parameters only apply to Shibboleth sessions, and not any sessions applications initiate.
<ul>
<li class="mandatory"><span class="fixed">wayfURL</span>: The URL of the <a href="#1.c.">WAYF service</a> responsible for redirecting users accessing this application.</li>
<li class="mandatory"><p><span class="fixed">shireURL</span>: Specifies the URL of the SHIRE POST URL, or assertion consumer service, at which new sessions are initiated. This can be an absolute URL, or a relative path to be prefixed by the base URL of the web site. Using an absolute URL allows a virtual server to funnel SHIRE requests to a fixed location.</p><p>Note that this URL will result in the cookie named by the <span class="fixed">cookieName</span> and <span class="fixed">cookieProps</span> elements being set, and this cookie must be returned in subsequent requests, so the virtual server's domain name and port must be consistent with the SHIRE's domain name and port for some browsers to properly return the cookie. If default ports are used (and thus left unspecified), browsers will generally return cookies set via SSL to a non-SSL server. If non-default ports are used, it is recommended that this be a relative URL so that each virtual host handles its own cookie operations.</p><p>For Shibboleth to function in IIS, the file extension at the end of this URL must match the value configured into IIS and mapped to the ISAPI extension. This causes the request to be serviced properly, even though no file by that name actually exists.</p></li>
<li><span class="fixed">shireSSL</span>: This boolean should be <span class="fixed">true</span> when the SHIRE will <b>only</b> accept POST requests over SSL as is strongly recommended; see <a href="#2.c.">section 2.c</a> for more details.</li>
<li class="mandatory"><span class="fixed">cookieName</span>: Specifies the name given to in-memory session cookies that are associated with this application.</li>
<li><span class="fixed">cookieProps</span>: A string of cookie properties can be specified using this element which give the browser further instructions about their processing and use.</li>
<li><span class="fixed">lifetime</span>: Specifies the duration in seconds of the Shibboleth session; this does not affect the lifetime of application sessions initiated subsequently.  If none is specified, sessions are unlimited by time.</li>
<li><span class="fixed">timeout</span>: If this duration in seconds elapses following the last request in a session, the session will be considered to have expired and a new session must be initiated for future requests.  Defaults to no timeout.</li>
<li><span class="fixed">checkAddress</span>: If <span class="fixed">true</span>, Shibboleth will check client addresses for impersonation protection.  In most circumstances, this should be enabled to prevent certain attacks          concerning stolen cookies, but this can cause problems for users behind proxies or NAT devices. Defaults to <span class="fixed">false</span>.
</ul></dd>

        <dd class="attribute"><a name="confSessionCacheProperties"><span class="fixed">&lt;SessionCacheProperties AAConnectTimeout=&quot;<i>seconds</i>&quot; AATimeout=&quot;<i>seconds</i>&quot; cacheTimeout=&quot;<i>seconds</i>&quot; cleanupInterval=&quot;<i>seconds</i>&quot; defaultLifetime=&quot;<i>seconds</i>&quot; propagateErrors=&quot;<i>true/false</i>&quot; retryInterval=&quot;<i>seconds</i>&quot; strictValidity=&quot;<i>true/false</i>&quot;</span></dd>
        <dd class="value">These attributes may all be specified as part of either the <a href="#confMySQLSessionCache"><span class="fixed">MySQLSessionCache</span></a> element or the <a href="#confMemorySessionCache"><span class="fixed">MemorySessionCache</span></a> element.  They are all optional.
<ul>
<li><span class="fixed">AAConnectTimeout</span>: Specifies in seconds the duration the target will wait before timing out on the initial connection to an origin to request attributes.  Defaults to <span class="fixed">15</span>.</li>
<li><span class="fixed">AATimeout</span>: Specifies in seconds the duration the target will wait before timing out on receiving attributes from the origin once the initial connection is established.  Defaults to <span class="fixed">30</span>.</li>
<li><span class="fixed">cacheTimeout</span>: The SHAR will make a fresh attribute request if it receives no response from the cache within this duration.  Defaults to <span class="fixed">28800</span>.</li>
<li><span class="fixed">cleanupInterval</span>: The cache will be purged of expired attribute sets with a frequency <span class="fixed">seconds</span>.  Defaults to <span class="fixed">300</span>.</li>
<li><span class="fixed">defaultLifetime</span>: If the assertion containing the attributes doesn't carry an expiration time, the assertion will expire after this time in <span class="fixed">seconds</span> has elapsed.  Defaults to <span class="fixed">1800</span>.</li>
<li><span class="fixed">propagateErrors</span>: If true, then any errors that occur during the attribute query are fatal and will be presented to the user as an error.  If false, any errors that occur during the query are non-fatal, and the
application will get attributes returned to it based on the population of <span class="fixed">strictValidity</span>.</p><p>This should generally only be treated as false by deployments that are using real principal names as subjects because attribute retrieval may be treated as optional or omitted entirely.</p></li>
<li><span class="fixed">retryInterval</span>: This is the amount of time between attempts to get fresh attributes.  If a query fails, a timer is set, and once the interval elapses, the next user request causes another query. This prevents pointless repeated attempts to query a failed AA.</li>
<li><span class="fixed">strictValidity</span>: If true, no expired attributes will ever be made available to the Shibboleth application; if no valid attributes can be obtained, then an empty set of attributes is provided.  When false, if no fresh set of attributes can be retrieved due to failures, cached attributes are made available, regardless of whether they have expired or not.  Defaults to <span class="fixed">true</span>.</li>
</ul></dd>

        <dd class="attribute"><a name="confSHAR"><span class="fixed">&lt;SHAR logger=&quot;<i>pathname</i>&quot;&gt;</span></dd>
        <dd class="value">This is the container element for configuration information pertaining to the SHAR, the main component of the target, which is responsible for requesting information about browser users from AA's.  Its single attribute, <span class="fixed">logger</span>, points toward a Log4J logger file that can be used by the SHAR.  It is contained by the <a href="#confShibbolethTargetConfig"><span class="fixed">ShibbolethTargetConfig</span></a> element and may contain an <a href="#confExtensions"><span class="fixed">Extensions</span></a> element specifying additional libraries.</p><p>It must contain either a <a href="#confUnixListener"><span class="fixed">UnixListener</span></a> element to listen to the Apache module on a UNIX domain socket or a <a href="#confTCPListener"><span class="fixed">TCPListener</span></a> element to listen on a TCP port.  Session caching for this SHAR must also be specified using a <a href="#confMemorySessionCache"><span class="fixed">MemorySessionCache</span></a> element to use in-memory session caching or a <a href="#confMySQLSessionCache"><span class="fixed">MySQLSessionCache</span></a> element to store session information in a MySQL database.</dd>

        <dd class="attribute"><a name="confShibbolethTargetConfig"><span class="fixed">&lt;ShibbolethTargetConfig&gt;</span></dd>
        <dd class="value">This is the main container element for the target configuration and must be present once and only once.  It must always contain a <a href="#confSHAR"><span class="fixed">SHAR</span></a> element, a <a href="#confSHIRE"><span class="fixed">SHIRE</span></a> element, an <a href="#confApplications"><span class="fixed">Applications</span></a> element, one or more <a href="#confCredentialsProvider"><span class="fixed">CredentialsProvider</span></a> elements, and optionally an <a href="#confExtensions"><span class="fixed">Extensions</span></a>.</dd>

        <dd class="attribute"><a name="confSHIRE"><span class="fixed">&lt;SHIRE logger=&quot;<i>pathname</i>&quot;&gt;</span></dd>
        <dd class="value">This is the container element for configuration information pertaining to the SHIRE, the part of the target that establishes sessions and passes on received attributes to applications.  Its single attribute, <span class="fixed">logger</span>, points toward a Log4J logger file that can be used by the SHIRE.  It is contained by the <a href="#confShibbolethTargetConfig"><span class="fixed">ShibbolethTargetConfig</span></a> element and may contain an <a href="#confExtensions"><span class="fixed">Extensions</span></a> element specifying additional libraries.</p><p>It must contain one <a href="#confImplementation"><span class="fixed">Implementation</span></a> element, within which configuration for the SHIRE which varies by platform will be specified.</p><p>One or more <a href="#confRequestMapProvider"><span class="fixed">RequestMapProvider</span></a> elements must be contained by this element, which serves to provide protection on individual pathnames served by the webserver.</dd>

        <dd class="attribute"><a name="confSite"><span class="fixed">&lt;Site <span class="mandatory">id=&quot;<i>IID</i>&quot; host=&quot;<i>fqdn</i>&quot;</span>/&gt;</span></dd>
        <dd class="value">This element is placed in the <a href="#confISAPI"><span class="fixed">ISAPI</span></a> element to specify a mapping from individual instance ID's to respective vhost domain names.</dd>

        <dd class="attribute"><a name="confTCPListener"><span class="fixed">&lt;TCPListener <span class="mandatory">address=&quot;<i>pathname</i>&quot;  port=&quot;<i>integer</i>&quot;</span> acl=&quot;<i>ip</i>&quot;&gt;</span></dd>
        <dd class="value">This element must be contained by the <a href="#confSHAR"><span class="fixed">SHAR</span></a> element and is mutually exclusive with the <a href="#confTCPListener"><span class="fixed">TCPListener</span></a> element.  It allows the SHAR to instead listen to the Apache module over TCP.
<ul><li class="mandatory"><span class="fixed">address</span>: Specifies the address of the listener.</li>
<li class="mandatory"><span class="fixed">port</span>: Specifies the TCP port on which the SHAR will listen.</li>
<li><span class="fixed">acl</span>: By default, the SHAR will only listen to Apache requests from 127.0.0.1 (localhost).  This should generally not be specified, but could be useful in some scenarios: if there were no way to plug a server farm into a shared session cache plugin, the server farm could all point at a networked SHAR service that writes to non-shared storage.  There is no wildcarding.</li>
</ul></dd>

        <dd class="attribute"><a name="confTrustProvider"><span class="fixed">&lt;TrustProvider type=&quot;edu.internet2.middleware.shibboleth.common.provider.XMLTrust&quot; uri=&quot;<i>pathname</i>&quot;/&gt;</span></dd>
        <dd class="value">This element, when specified within a <a href="#confPolicy"><span class="fixed">Policy</span></a> element, provides information on signing keys and certificates for use in interactions with AA's.  This should be updated regularly; see <a href="#4.g.">section 4.g</a> for further details.</dd>

        <dd class="attribute"><a name="confUnixListener"><span class="fixed">&lt;UnixListener address=&quot;<i>pathname</i>&quot;/&gt;</span></dd>
        <dd class="value">Use this element to specify a UNIX domain socket located at the <span class="fixed">pathname</span> specified in the <span class="fixed">address</span> attribute the SHAR should listen for Apache module requests on rather than on a TCP port.  This element must be contained by the <a href="#confSHAR"><span class="fixed">SHAR</span></a> element and is mutually exclusive with the <a href="#confTCPListener"><span class="fixed">TCPListener</span></a> element.  <span class="fixed">UnixListener</span> cannot be specified for Windows-based installations.</dd>

</dl></blockquote>
<h4><a name="4.b."></a>4.b. Dynamic Error Page Generation</h4>
<blockquote>
    <p>Shibboleth supports the dynamic generation of information in error pages 
    referenced by <span class="fixed">shibboleth.xml</span>. The Shib Target 
    employs a special Markup Language Processor to insert special tags into the 
    generated HTML. The parser will read the error file looking for any tag that 
    looks like:</p>
    <blockquote>
        <p><span class="fixed">&lt;shibmlp tag-name /&gt;</span> </p>
    </blockquote>
    <p>Shibboleth will replace <span class="fixed">tag-name</span> with the 
    appropriate markup tag from the table below:</p>
    <dl>
        <dd class="attribute"><span class="fixed">supportContact</span></dd>
        <dd class="value">The value of the <span class="fixed">supportContact</span> 
        for this web site.</dd>
        <dd class="attribute"><span class="fixed">logoLocation</span></dd>
        <dd class="value">The value of the <span class="fixed">logoLocation</span> 
        for this web site. This is used to fill in the template error page only; 
        if a custom error page is created, then the image may be linked to 
        statically by the page itself.</dd>
        <dd class="attribute"><span class="fixed">requestURL</span></dd>
        <dd class="value">The user&#39;s requested URL.</dd>
        <dd class="attribute"><span class="fixed">errorType</span></dd>
        <dd class="value">The type of error.</dd>
        <dd class="attribute"><span class="fixed">errorText</span></dd>
        <dd class="value">The actual error message.</dd>
        <dd class="attribute"><span class="fixed">errorDesc</span></dd>
        <dd class="value">A textual description of the error intended for human 
        consumption.</dd>
        <dd class="attribute"><span class="fixed">originContactName</span></dd>
        <dd class="value">The contact name for the origin site provided by that 
        site&#39;s metadata.</dd>
        <dd class="attribute"><span class="fixed">originContactEmail</span></dd>
        <dd class="value">The contact email address for the origin site provided 
        by that site&#39;s metadata.</dd>
        <dd class="attribute"><span class="fixed">originErrorURL</span></dd>
        <dd class="value">The URL of an error handling page for the origin site 
        provided by that site&#39;s metadata.</dd>
    </dl>
    <p>This configuration is only for Apache servers, and is only used by 
    resources protected by Shibboleth. See <a href="#4.d.">section 4.d.</a></p>
    <p>Sample error templates for different kinds of errors are included in the 
    Shibboleth distribution, and can be triggered by anything that will cause 
    Shibboleth to be unable to make an authorization decision, including a bad 
    sites file, certificate verification failures, or a skewed clock between 
    sites.</p>
    <p><b>You should edit these templates, provide or remove style sheets and 
    images, and otherwise customize these templates to suit the user experience 
    you want your users to have when errors occur. The defaults are not likely 
    to meet the needs of any site.</b></p>
</blockquote>
<h4><a name="4.c."></a>4.c. Key Generation and Certificate Installation</h4>
<blockquote>
    <p>The only target component that must have a private key and certificate is 
    the SHAR. While the target server itself should support SSL in most cases 
    for users, it is mandatory for the SHAR to authenticate when contacting an 
    AA, and it must therefore be given a key and an SSL client certificate. It 
    is permissible for the SHAR to use the same keypair and certificate used by 
    the target web server itself, provided the certificate is signed by a CA 
    accepted by the origin sites that will be queried for attributes.</p>
    <p>On Unix, we require that OpenSSL be installed to use Shibboleth. On 
    Windows, OpenSSL libraries and the command line tool are included in the 
    package and can be used directly, if not otherwise available.</p>
    <p>The certificate and key file location should be based on whether they 
    will also be used for Apache. If they will be used as a server certificate 
    as well, they should probably be in the Apache tree in the usual
    <span class="fixed">mod_ssl</span>-defined locations inside the Apache 
    configuration folder., and the SHAR can read them from there. If the SHAR is 
    not running as <span class="fixed">root</span>, permissions might need to be 
    changed to allow this access. If the certificate and key will only be used 
    for the SHAR, they can be put in the same folder with the
    <span class="fixed">shibboleth.xml</span> file and protected appropriately.</p>
    <p>Other web servers like IIS do not use the raw PEM format that Apache and 
    Shibboleth can share, and therefore the components must generally use 
    separate copies of the key and certificate if they are to be shared. Most 
    other servers can export and/or import keys to and from PEM format or other 
    formats that OpenSSL can convert. Refer to your server&#39;s documentation or 
    ask for assistance from others who use it.</p>
    <p>The SHAR is assigned a key and a certificate using shibboleth.xml&#39;s
    <span class="fixed">certFile</span>, <span class="fixed">keyFile</span> and
    <span class="fixed">keyPass</span> settings, described in <a href="#4.a.">
    section 4.a.</a> These files must currently be in PEM format. OpenSSL 
    commands to generate a new keypair and a certificate request are shown here, 
    assuming 2048 bit RSA keys are to be used:</p>
    <blockquote>
        <p><span class="fixed">$ openssl genrsa -des3 -out ssl.key 2048<br>
        $ openssl req -new -key ssl.key -out ssl.csr</span> </p>
    </blockquote>
    <p>The signed certificate file returned by the CA should be usable directly, 
    or can be converted to PEM format using the <span class="fixed">openssl x509</span> 
    command.</p>
    <p>If the key is to be shared with Apache, the web server&#39;s child processes, 
    often running as <span class="fixed">nobody</span>, must be able to read 
    them while the server is running, which may require permission changes.</p>
    <p>This particularly applies when sharing the key and certificate used by 
    mod_ssl, which are only readable by root by default. The password, if any, 
    must be placed in the <span class="fixed">shibboleth.xml</span> file, since 
    the Apache module cannot prompt for it during initial startup as mod_ssl 
    can. The issues surrounding how to securely obtain a key while running as
    <span class="fixed">nobody</span> may be addressed in a later release. Since 
    the password will be stored in clear text in a frequently examined file, it 
    is suggested to use a password not used elsewhere.</p>
    <p>Finally, the <span class="fixed">calist</span> command provides the SHAR 
    with a set of CA roots to trust when validating AA server certificates. In 
    all cases, the SHAR verifies that the certificate&#39;s Subject CN equals the 
    AA&#39;s hostname, but the CA list restricts the accepted signers to those 
    permitted by the SHAR. The parameter can be omitted to skip such validation, 
    but this is not secure.</p>
</blockquote>
<h4><a name="4.d."></a>4.d. Protecting Web Pages</h4>
<blockquote>
    <p>Protection of web pages is primarily achieved through &quot;mapping&quot; 
    attributes provided by an AA to a localized vocabulary for authorization 
    rules. This was formerly accomplished in Apache with the <span class="fixed">
    ShibMapAttribute</span> command, but this has been replaced with additional 
    features in the AAP syntax, described in <a href="#4.e.">section 4.e.</a> 
    This applies to both Apache and IIS.</p>
    <p><b><u>IIS</u></b></p>
    <p>The IIS RM module supports the mapping of attributes via AAP files, but 
    it does not support rule-based policies and therefore cannot protect static 
    content at this time. In addition, all of the configuration settings are 
    managed globally or per-site and are pulled from the <span class="fixed">
    shibboleth.xml</span> file, so there are no additional commands to document 
    at this time.<br>
    </p>
    <p><b><u>Apache</u></b></p>
    <p>The Apache RM module provided can interpret AAP settings to map 
    attributes to HTTP request headers and to <span class="fixed">Require</span> 
    rules, permitting protecting of both static and dynamic content. The 
    commands described here can appear in content-specific configuration blocks 
    or <span class="fixed">.htaccess</span> files. They determine what content 
    is to be protected, session policies, and static access control rules.</p>
    <p>Any of the typical ways of protecting content may be used (.htaccess, 
    Directory, Location, Files, etc.). There are two ways to trigger Shibboleth 
    authentication: specifying an <span class="fixed">AuthType</span> of
    <span class="fixed">shibboleth</span> to use Shibboleth directly, or using
    <span class="fixed">ShibBasicHijack</span> to process existing .htaccess 
    files using Shibboleth instead. Support for authorization consists of 
    mod_auth-style require directives, as well as support for mod_auth group 
    files.</p>
    <p>A complete list of the directives and their values is below:</p>
    <dl>
        <dd class="attribute"><span class="fixed">AuthType &lt;string&gt;</span></dd>
        <dd class="value">Use <span class="fixed">shibboleth</span> for direct 
        invocation, or <span class="fixed">Basic</span> plus the
        <span class="fixed">ShibBasicHijack</span> option described below.</dd>
        <dd class="attribute"><span class="fixed">ShibSSLOnly &lt;on/off&gt;</span></dd>
        <dd class="value">Controls whether Shibboleth will reject non-SSL 
        requests for resources from clients. Defaults to <span class="fixed">off</span>.</dd>
        <dd class="attribute"><span class="fixed">ShibBasicHijack &lt;on/off&gt;</span></dd>
        <dd class="value">Controls whether Shibboleth should or should not 
        ignore requests with <span class="fixed">AuthType Basic</span>. Defaults 
        to <span class="fixed">off</span>.</dd>
        <dd class="attribute"><span class="fixed">ShibExportAssertion &lt;on/off&gt;</span></dd>
        <dd class="value">Controls whether the SAML attribute assertion provided 
        by the AA is exported in a base64-encoded HTTP header,
        <span class="fixed">Shib-Attributes</span>. Defaults to
        <span class="fixed">off</span>. While this does require parsing the raw 
        XML, it also permits an application to see attributes that may have been 
        filtered by an AAP, or to forward the SAML assertion to a third party.</dd>
        <dd class="attribute"><span class="fixed">ShibAuthLifetime &lt;seconds&gt;</span></dd>
        <dd class="value">If set, sessions are always terminated after the 
        specified number of seconds, resulting in a new redirect and request for 
        authentication, just as if a new request without a session is received. 
        Defaults to infinite.</dd>
        <dd class="attribute"><span class="fixed">ShibAuthTimeout &lt;seconds&gt;</span></dd>
        <dd class="value">If set, sessions are always terminated after the 
        specified number of seconds of inactivity (defined as no requests 
        received in that session), resulting in a new redirect and request for 
        authentication, just as if a new request without a session is received. 
        Defaults to infinite.</dd>
        <dd class="attribute"><span class="fixed">AuthGroupFile &lt;pathname&gt;</span></dd>
        <dd class="value">Same as mod_auth; collects values found in REMOTE_USER 
        into a named group for access control. An attribute must be mapped to 
        REMOTE_USER for this to work. Note that mod_auth will not support group 
        files when mod_shibrm is loaded, since they share the same command.
        <p><a href="http://httpd.apache.org/docs/mod/core.html#require">This is 
        implemented</a> by placing a <span class="fixed">.htaccess</span> file 
        that references a group file stored at <span class="fixed">/pathname</span>:</p>
        <blockquote>
            <p><span class="fixed">AuthGroupFile /pathname<br>
            require group workgroup</span></p>
        </blockquote>
        <p>An
        <a href="http://httpd.apache.org/docs/mod/mod_auth.html#authgroupfile">
        AuthGroupFile</a> used by Shibboleth might resemble:<br>
        <span class="fixed">workgroup: joe@example.edu, jane@demo.edu, jim@sample.edu</span>
        </dd>
        <dd class="attribute"><span class="fixed">Require &lt;string&gt;</span></dd>
        <dd class="value">Enforce authorization using one of the following 
        methods.<ul type="circle">
            <li><span class="fixed">valid-user</span><blockquote>
                <p>Any Shibboleth user from a trusted origin site is accepted, 
                even if no actual attributes are received. This is a very 
                minimal kind of policy, but is useful for testing or for 
                deferring real policy to an application.</p>
            </blockquote>
            </li>
            <p><span class="fixed">user</span></p>
            <blockquote>
                <p>A space-delimited list of values, such as from the
                <span class="fixed">
                urn:mace:dir:attribute-def:eduPersonPrincipalName</span> 
                attribute. Actually, any attribute can be mapped to REMOTE_USER, 
                even if this doesn&#39;t always make sense.</p>
            </blockquote>
            </li>
            <li><span class="fixed">group</span><blockquote>
                <p>A space-delimited list of group names defined within
                <span class="fixed">AuthGroupFile</span> files, again provided 
                that a mapping to <span class="fixed">REMOTE_USER</span> exists.</p>
            </blockquote>
            </li>
            <li><span class="fixed">&lt;alias&gt;</span><blockquote>
                <p>An arbitrary rule name that matches an Alias defined in an 
                AAP file. The rule value is a space-delimited list of attribute 
                values, whose format depends on the attribute in question (e.g. 
                an affiliation rule might look like:</p>
                <p><span class="fixed">require affiliation staff@osu.edu 
                faculty@mit.edu</span></p>
            </blockquote>
            </li>
        </ul>
        <p>Additionally, for <span class="fixed">user</span> and
        <span class="fixed">&lt;alias&gt;</span>-based rules, if a tilde character is 
        placed immediately following <span class="fixed">user</span> or
        <span class="fixed">&lt;alias&gt;</span>, the expressions that follow are 
        treated as regular expressions. The syntax supported is generally based 
        on the one defined by <a href="http://www.w3.org/TR/xmlschema-2/#regexs">
        XML Schema</a>. This specification borders on unreadable, but the syntax 
        is generally Perl-like. Expressions should generally be &quot;anchored&quot; with 
        the ^ and $ symbols to insure mid-string matches don&#39;t cause false 
        positives.</p>
        <p>For example, the rule:<br>
&nbsp;&nbsp;&nbsp; <span class="fixed">require affiliation ~ ^member@.+\.edu$<br>
        </span>would evaluate to allowing anyone with an <span class="fixed">
        affiliation</span> of <span class="fixed">member</span> from a .edu 
        domain.</dd>
    </dl>
</blockquote>
<h4><a name="4.e."></a>4.e. Defining Attributes and Acceptance Policies</h4>
<blockquote>
    <p>Shibboleth allows a user and a site to release a varying set of 
    attributes to a destination site, and does not impose restrictions on the 
    kinds of attribute information provided by an AA. Target implementations 
    must be prepared to examine the attributes they receive and filter them 
    based on policies about what information to permit an origin site to assert 
    about its users.</p>
    <p>Attribute acceptance is the process of defining acceptable attributes and 
    filtering attribute values before passing them on to a resource manager, 
    such as the <span class="fixed">mod_shibrm</span> module. Data blocked by 
    AAP filters will not be passed to the CGI environment or used when enforcing
    <span class="fixed">.htaccess</span> rules. Note that the attribute 
    assertion exported to the <span class="fixed">Shib-Attributes</span> header 
    is unfiltered.</p>
    <p>The Shibboleth implementation supports Scoped and Simple attributes and 
    filtering policies for different kinds of attributes, and is potentially 
    extensible to more complex attributes in the future. An attribute is 
    considered Scoped if the XML representation of its values contains a &quot;Scope&quot; 
    attribute. As of 1.1, this is detected at runtime and requires no 
    configuration in advance.</p>
    <p><b>An essential part of the Shibboleth trust fabric is ensuring that 
    sites only assert attributes for domains for which they are considered 
    authoritative by the target. Typically, this means that Brown University 
    will be trusted to assert attributes only scoped to <span class="fixed">
    brown.edu</span>. Unless there are very specific circumstances requiring 
    this restriction be removed, it is strongly encouraged that such policies be 
    in place.</b></p>
    <h4>Scoped:</h4>
    <blockquote>
        <p>Scoped attributes are a special kind of attribute whose values are a 
        combination of a <span class="fixed">value</span> and a
        <span class="fixed">scope</span>, or <span class="fixed">context</span> 
        for the value. An example is <span class="fixed">
        eduPersonScopedAffiliation</span>, which adds a scope to the defined set 
        of <span class="fixed">eduPersonAffiliation</span> values, such as
        <span class="fixed">student</span>, <span class="fixed">member</span>, 
        or <span class="fixed">faculty</span>. Scopes are expressed as DNS 
        domains and subdomains.</p>
        <p>Any <span class="fixed">scoped</span> attribute can be scoped only to 
        the origin site&#39;s permitted domains. These domains are listed in the 
        site metadata that provides policy information to the system. Domains 
        can be explicit or regular expressions, and can be changed by a target 
        to meet its needs. Targets can also override the rules specified for the 
        site in their own AAPs, choosing to accept additional scopes or deny 
        scopes that would ordinarily be accepted based on metadata provided by a 
        federation. Thus, attribute acceptance processing for
        <span class="fixed">scoped</span> attributes is based on site metadata 
        and target-specified overrides in addition to the mechanism described 
        below for <span class="fixed">simple</span> attributes.</p>
        <p>Scope rules specified in an AAP are additive with any domains 
        permitted by site metadata, and the rules are applied by first looking 
        for an applicable denial rule, and then looking at site metadata and any 
        applicable site rules for an accept rule.</p>
    </blockquote>
    <h4>Simple:</h4>
    <blockquote>
        <p>Simple attributes are attributes whose value is expressed in XML as a 
        Text node; that is, the value is just a string. Multiple values are 
        permitted. <span class="fixed">eduPersonEntitlement</span>, in which the 
        values are URIs, is one example of a simple attribute.</p>
        <p>Both Simple and Scoped attribute acceptance is controlled with an 
        external policy file written in XML. The schema for the file is 
        described by the <span class="fixed">shibboleth.xsd</span> schema, and 
        an example file is included, <span class="fixed">AAP.xml</span>. It is 
        mandatory to supply such a file, because attributes are recognized based 
        on their presence in this file, and not by separate configuration 
        processes. Only by listing an attribute in the file will it be accepted 
        and processed by the RM.</p>
        <p>The policy is a default-deny algorithm that requires permissible 
        attributes and values be listed explicitly. That is, an empty file 
        permits nothing. Each attribute to be supported must be listed in the 
        file by name in an <span class="fixed">&lt;AttributeRule&gt;</span>. Each such 
        rule is a collection of <span class="fixed">&lt;SiteRule&gt;</span> elements 
        along with an optional <span class="fixed">&lt;AnySite&gt;</span> default 
        rule. In turn each site rule is a set of <span class="fixed">&lt;Value&gt;</span> 
        rules that specify matches to permit, either literal or regular 
        expressions, or a wildcarded <span class="fixed">&lt;AnyValue&gt;</span> 
        default rule, which is equivalent to a single regular expression rule 
        allowing anything.</p>
    </blockquote>
    <p>A syntax summary follows:</p>
    <blockquote>
        <p><span class="fixed">&lt;AttributeAcceptancePolicy</span></p>
        <blockquote>
            <p>The top level element in the file.</p>
        </blockquote>
        <p><span class="fixed">&lt;AttributeRule<br>
&nbsp;&nbsp;&nbsp; Name=&quot;urn:mace:dir:attribute-def:eduPersonScopedAffiliation&quot;<br>
&nbsp;&nbsp;&nbsp; Header=&quot;Shib-EP-Affiliation&quot; Alias=&quot;affiliation&quot;&gt;</span></p>
        <blockquote>
            <p>Specifies a rule for an attribute, named by its URI. The 
            following XML attributes can be supplied:</p>
            <table border="1" cellpadding="5" cellspacing="5">
                <tr>
                    <td><span class="fixed">Name</span></td>
                    <td>The name of the Shibboleth attribute, usually a URI. 
                    This is the only required XML attribute.</td>
                </tr>
                <tr>
                    <td><span class="fixed">Namespace</span></td>
                    <td>If the attribute&#39;s name includes a SAML namespace, 
                    supply it here. Normally this is unused.</td>
                </tr>
                <tr>
                    <td><span class="fixed">Header</span></td>
                    <td>The HTTP request header to map the attribute&#39;s values 
                    to.</td>
                </tr>
                <tr>
                    <td><span class="fixed">Alias</span></td>
                    <td>A short name for the attribute, determines the name of 
                    the Apache <span class="fixed">Requires</span> rule.</td>
                </tr>
            </table>
        </blockquote>
        <p><span class="fixed">&lt;AnySite&gt;</span></p>
        <blockquote>
            <p>Specifies a rule that always applies to the attribute, regardless 
            of the asserting AA.</p>
        </blockquote>
        <p><span class="fixed">&lt;SiteRule Name=&quot;host.domain.com&quot;&gt;</span></p>
        <blockquote>
            <p>A rule that applies to the origin site AA corresponding to the 
            hostname.</p>
        </blockquote>
        <p><span class="fixed">&lt;Scope Accept=&quot;true|false&quot; Type=&quot;type&quot;&gt;</span></p>
        <blockquote>
            <p>Specifies a value to accept or deny, either directly using
            <span class="fixed">type</span> <span class="fixed">literal</span>, 
            or using a set of matching expressions as <span class="fixed">type</span>
            <span class="fixed">regexp</span>. <span class="fixed">literal</span> 
            is the default if <span class="fixed">Type</span> is not specified. 
            Accept defaults to &quot;true&quot;&gt;.</p>
        </blockquote>
        <p><span class="fixed">&lt;AnyValue&gt;</span></p>
        <blockquote>
            <p>Specifies a rule that always applies to the attribute and site, 
            regardless of the value(s).</p>
        </blockquote>
        <p><span class="fixed">&lt;Value Type=&quot;type&quot;&gt;</span></p>
        <blockquote>
            <p>Specifies a value to permit, either directly using
            <span class="fixed">type</span> <span class="fixed">literal</span>, 
            or using a set of matching expressions as <span class="fixed">type</span>
            <span class="fixed">regexp</span>. <span class="fixed">literal</span> 
            is the default if <span class="fixed">Type</span> is not specified.</p>
        </blockquote>
    </blockquote>
    <p>The regular expression syntax is a subset of the usual Perl and Unix 
    syntaxes that is described in the XML Schema specification by the W3C. Most 
    typical expressions should work. Be sure to anchor them using
    <span class="fixed">^</span> and <span class="fixed">$</span> to avoid 
    unintentional matches midstring.</p>
</blockquote>
<h4><a name="4.f."></a>4.f. Using Attributes in Applications</h4>
<blockquote>
    <p>Apart from the simple RM functionality provided, attribute information 
    may be made available directly to applications via the standard practice of 
    creating custom HTTP request headers before passing control to the 
    application. Applications should make no assumption about the presence of 
    specific attributes for their use unless they have intimate knowledge of the 
    attribute release policies in place.</p>
    <p>The AAP metadata controls this interface, and maps a Shibboleth attribute 
    to a header name, such as <span class="fixed">Shib-EP-Affiliation</span>. 
    Using that example, any values of the mapped attribute will be placed in 
    that header, delimited by semicolons. An application that uses a CGI-like 
    syntax to access the header will find the values in the <span class="fixed">
    HTTP_SHIB_EP_AFFILIATION</span> variable. Any attribute can be placed in any 
    header, to drive legacy applications that expect information in a particular 
    location.</p>
    <p>The <span class="fixed">REMOTE_USER</span> variable is a special case 
    that is generally populated automatically by the web server based on an 
    internal piece of data that represents the current <span class="fixed">
    username</span>. Unlike many authentication modules, Shibboleth does not 
    guarantee that <span class="fixed">REMOTE_USER</span> will have any value, 
    because users may remain anonymous in many cases. If it does have a value, 
    it is set solely because of an AAP file that maps an attribute to that 
    header name. For many purposes, the <span class="fixed">
    urn:mace:dir:attribute-def:eduPersonPrincipalName</span> attribute should be 
    mapped to <span class="fixed">REMOTE_USER</span>. Even so, EPPN may not be 
    provided by the AA, and <span class="fixed">REMOTE_USER</span> might still 
    be empty.</p>
    <p>The <span class="fixed">Shib-Origin-Site</span> variable will contain the 
    unique name/identifier of the origin site of the user. Some applications may 
    use this to lookup additional policy or application data. It normally takes 
    the form of a URI but could be any string in some deployments.</p>
    <p>Finally, configuration may instruct the web server to place the entire 
    XML message containing the SAML attribute information from the AA into a 
    base64-encoded header called <span class="fixed">Shib-Attributes</span>. 
    This is a raw interface that provides an application with the entire AA 
    response, and is not a filtered view based on any attribute acceptance rules 
    or even based on what attributes are recognized by the target. What was sent 
    is what you see.</p>
</blockquote>
<h4><a name="4.g."></a>4.g. <span class="fixed">siterefresh</span></h4>
<blockquote>
    <p>Shibboleth provides a simple tool called <span class="fixed">siterefresh</span> 
    in the <span class="fixed">/opt/shibboleth/bin</span> folder of the 
    distribution to maintain metadata files referenced by <span class="fixed">
    shibboleth.xml</span>. It will return 0 on success and a negative number on 
    failure and log errors to <span class="fixed">stderr</span>. If the data in 
    the new metadata file is bad or the signature is invalid, the existing copy 
    is kept. The SHAR and SHIRE stat all metadata files each time the data is 
    used, allowing them to detect and utilize updates in real-time operation.</p>
    <p><span class="fixed">siterefresh</span> takes the following command-line 
    parameters:</p>
    <dl>
        <dd class="attribute"><span class="fixed">--url &lt;URL&gt;</span> </dd>
        <dd class="value">Specifies the <span class="fixed">URL</span> of the 
        remote metadata file with which to update the local file.</dd>
        <dd class="attribute"><span class="fixed">--out &lt;pathname&gt;</span> </dd>
        <dd class="value">Specifies the local file to which to write the new 
        metadata.</dd>
        <dd class="attributeopt"><span class="fixed">--cert &lt;pathname&gt;</span>
        </dd>
        <dd class="valueopt">Specifies the location of a certificate stored in
        <span class="fixed">PEM</span> format used to validate the signature of 
        the metadata file. Since much of Shibboleth&#39;s security flows from 
        metadata files, this option is highly recommended, and the certificate 
        used should be verified independently.</dd>
        <dd class="attributeopt"><span class="fixed">--schema &lt;pathname&gt;</span>
        </dd>
        <dd class="valueopt">Optionally defines a base path for schemas to use 
        when validating the file. Defaults to <span class="fixed">
        /opt/shibboleth/etc/shibboleth/</span>.</dd>
    </dl>
    <p>A complete command issued to <span class="fixed">siterefresh</span> might 
    take the form:</p>
    <blockquote>
        <p><span class="fixed">/opt/shibboleth/bin/siterefresh --out sites.xml 
        --cert internet2.pem \<br>
        --url http://wayf.internet2.edu/InQueue/sites.xml </span></p>
    </blockquote>
    <p>It is recommended that similar commands be added to a <span class="fixed">
    crontab</span> to keep the site and trust files refreshed. AAP files tend to 
    be site-specific, but could be maintained and distributed centrally. If the 
    command is invoked in a script that writes the file to a new location and 
    compares it with the old contents before overwriting the original, the 
    command could be run very often without impacting target operations, 
    providing a high degree of currency in case sites become compromised.</p>
</blockquote>
<h4><a name="4.h."></a>4.h. MySQL Session Cache</h4>
<blockquote>
    <p>Shibboleth includes a useful plugin that extends the default memory cache 
    for storing session data in the SHAR with a backing cache using an embedded 
    MySQL database. In most distributions, it is enabled by default. The plugin 
    can be found in the <span class="fixed">/opt/shibboleth/libexec</span> 
    folder, and is loaded as an extension library using the <span class="fixed">
    [extensions:saml]</span> section of <span class="fixed">shibboleth.xml</span>. 
    The following configuration options are available:</p>
    <dl>
        <dd class="attributeopt"><span class="fixed">mysql-cache-timeout = 
        &lt;seconds&gt;&nbsp;&nbsp;&nbsp; (in [shar] section)</span></dd>
        <dd class="valueopt">Specifies the duration in <span class="fixed">
        seconds</span> that must elapse between user accesses before that user&#39;s 
        session is purged from the persistent cache. Defaults to
        <span class="fixed">28800</span> seconds, or 8 hours. This should 
        generally be longer than the associated server&#39;s settings for session 
        lifetime and timeout, and the memory cache&#39;s timeout.</dd>
        <dd class="attributeopt"><span class="fixed">&lt;MySQL Arguments&gt;&nbsp;&nbsp;&nbsp; 
        (one per line in [mysql] section)</span></dd>
        <dd class="valueopt">To pass arguments to the MySQL engine, create 
        argument lines in the <span class="fixed">[mysql]</span> section in the 
        form:
        <blockquote class="fixed">
            <p>arg1=&lt;argument&gt;<br>
            arg2=&lt;argument&gt;<br>
            etc... </p>
        </blockquote>
        <p>Important arguments you&#39;ll find by default include: </p>
        <blockquote class="fixed">
            <p>arg1 = --language=/opt/shibboleth/share/english<br>
            arg2 = --datadir=/opt/shibboleth/data</p>
        </blockquote>
        <p>which set the message file path and the location of the cache&#39;s 
        database files respectively. Make sure the data directory exists before 
        starting the SHAR if you change this path.</dd>
    </dl>
</blockquote>
<p><br>
</p>
<hr>
<h3><a name="5."></a>5. Troubleshooting</h3>
<p>This section provides basic information about testing Shibboleth targets. 
This information is not intended to be comprehensive, but instead rudimentary 
guidelines for basic configuration tests and problems. For more detailed 
information or answers to specific problems not addressed in this section, 
please mail <a href="mailto:mace-shib-users@internet2.edu">
mace-shib-users@internet2.edu</a> with a thorough description of errors and 
configurations used.</p>
<h4><a name="5.a."></a>5.a. Basic Testing</h4>
<blockquote>
    <p>The target may be tested by generating a folder with very basic access 
    controls on it, and accessing it using a web browser. Place a simple webpage 
    such as <span class="fixed">index.html</span> in <span class="fixed">
    /secure/</span>. Then, add the following lines to <span class="fixed">
    httpd.conf</span>, which should be removed when testing is over:</p>
    <blockquote>
        <p><span class="fixed"># Configure a test directory<br>
        &lt;Location /secure&gt;<br>
        &nbsp;&nbsp;AuthType shibboleth<br>
        &nbsp;&nbsp;require valid-user<br>
        <br>
        &nbsp;&nbsp;# Per-directory SHIRE Configuration<br>
        &nbsp;&nbsp;#ShibBasicHijack On<br>
        &nbsp;&nbsp;#ShibSSLOnly On<br>
        &nbsp;&nbsp;#ShibAuthLifetime 60<br>
        &nbsp;&nbsp;#ShibAuthTimeout 600<br>
        <br>
        &nbsp;&nbsp;# RM Configuration<br>
        &nbsp;&nbsp;#AuthGroupFile /foo<br>
        &nbsp;&nbsp;#ShibExportAssertion On<br>
        &lt;/Location&gt;<br>
        </span></p>
    </blockquote>
    <p><b>For information regarding specific error messages that may be 
    generated if the target does not work successfully, please refer to section
    <a href="#5.b.">5.b.</a>, or write
    <a href="mailto:mace-shib-users@internet2.edu">mace-shib-users@internet2.edu</a>.</b></p>
</blockquote>
<h4><a name="5.b."></a>5.b. Common Problems</h4>
<blockquote>
    <p>A knowledge base is being developed in the
    <a href="http://www.columbia.edu/~wassa/shib.faq/shibboleth-faq.html">
    Shibboleth Deployer&#39;s FAQ</a>. Please mail
    <a href="mailto:mace-shib-users@internet2.edu">mace-shib-users@internet2.edu</a> 
    with any additional questions or problems encountered that are not answered 
    by this basic guide.</p>
</blockquote>

</body>

</html>
