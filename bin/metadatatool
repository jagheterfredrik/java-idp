##We need a JVM
if [ ! -n "$JAVA_HOME" ] ; then
  echo "Error: JAVA_HOME is not defined."
  exit
fi

if [ ! -n "$JAVACMD" ] ; then
  JAVACMD=$JAVA_HOME/bin/java
fi

if [ ! -x "$JAVACMD" ] ; then
  echo "Error: JAVA_HOME is not defined correctly."
  echo "Cannot execute $JAVACMD"
  exit
fi


##Find the shibboleth components
if [ ! -n "$SHIB_HOME" ] ; then
  SHIB_HOME=.
fi
ENDORSED=$SHIB_HOME/endorsed

##Grab all the dependencies
if [ -n "$CLASSPATH" ] ; then
  SHIB_UTIL_CLASSPATH=$CLASSPATH
fi
SHIB_UTIL_CLASSPATH=$SHIB_UTIL_CLASSPATH:$SHIB_HOME/webApplication/WEB-INF/classes

DIRLIBS=${SHIB_HOME}/lib/*.jar
for i in ${DIRLIBS}
do
    # if the directory is empty, then it will return the input string
    # this is stupid, so case for it
    if [ "$i" != "${DIRLIBS}" ] ; then
      if [ -z "$SHIB_UTIL_CLASSPATH" ] ; then
        SHIB_UTIL_CLASSPATH=$i
      else
        SHIB_UTIL_CLASSPATH="$i":$SHIB_UTIL_CLASSPATH
      fi
    fi
done


##Here we go
$JAVACMD -Djava.endorsed.dirs="$ENDORSED" -Dlog.config="$LOG_CONFIG" -cp $SHIB_UTIL_CLASSPATH  edu.internet2.middleware.shibboleth.utils.MetadataTool "$@"
