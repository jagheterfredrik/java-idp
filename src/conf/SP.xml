<?xml version="1.0" encoding="UTF-8"?>

<!-- Test SP configuration file for Example State University 
	 There is one Metadata Entity: urn:mace:inqueue:example.org
	 It has both IdP and SP Roles.
	 It has one server: //shibboleth.example.org:8080
	 The endpoints are in the /shibboleth context on the server
	 
	 Dependencies:
	 Must agreed with referenced external ExampleMetadata file.
	 Endpoints must agree with Servlet mappings in web.xml
	 Certificates must be generated for these names
	 The "hosts" file maps shibboleth.example.org to 127.0.0.1
-->

<ShibbolethTargetConfig xmlns="urn:mace:shibboleth:target:config:1.0"
        logger="/conf/shibboleth.logger" 
		clockSkew="180">

    <SHAR>
		<TCPListener address="127.0.0.1" port="1600" acl="127.0.0.1"/>
        <MemorySessionCache cleanupInterval="300" cacheTimeout="3600" AATimeout="30" AAConnectTimeout="15"
            defaultLifetime="1800" retryInterval="300" strictValidity="false" propagateErrors="true"/>
     </SHAR>

    <SHIRE>
        <RequestMapProvider type="edu.internet2.middleware.shibboleth.serviceprovider.XMLRequestMap">
            <RequestMap applicationId="default">
               <Host name="shibboleth.example.org" scheme="https">
                    <Path name="secure" requireSession="true" exportAssertion="true" />
                </Host>
                <Host name="shibboleth.example.org" port="8080" scheme="http">
                    <Path name="secure" requireSession="true" exportAssertion="true"/>
                </Host>
            </RequestMap>
        </RequestMapProvider>
    </SHIRE>

    <Applications xmlns:saml="urn:oasis:names:tc:SAML:1.0:assertion"
        id="default" providerId="http://shibboleth.example.org/shibboleth">

        <!--
        Controls session lifetimes, address checks, cookie handling, WAYF, and the SHIRE location.
        You MUST supply a unique shireURL value (and a wayfURL that can be the same) for each of your
        applications. The value can be a relative path, a URL with no hostname (https:///path) or a
        full URL. The system will compute the value that applies based on the resource. Using
        shireSSL="true" will force the protocol to be https. You should also add a cookieProps
        setting of "; secure" in that case. The default wayfURL is the InQueue federation's service.
        Change to https://localhost/shibboleth/HS for internal testing against your own origin.
        -->
        <Sessions lifetime="7200" timeout="3600" checkAddress="true"
            wayfURL="http://shibboleth.example.org:8080/shibboleth/HS"
            shireURL="http://shibboleth.example.org:8080/shibboleth/Shibboleth.shire" 
			shireSSL="false"/>

        <!--
        You should customize these pages! You can add attributes with values that can be plugged
        into your templates.
        -->
        <Errors shire="shibboleth/shireError.html"
            rm="shibboleth/rmError.html"
            access="shibboleth/accessError.html"
            supportContact="root@localhost"
            logoLocation="/shibboleth/logo.jpg"
            styleSheet="/shibboleth/main.css"/>

        <!-- Indicates what credentials to use when communicating -->
        <CredentialUse TLS="defcreds" Signing="defcreds">
            <!-- RelyingParty elements customize credentials for specific origins or federations -->
            <!--
            <RelyingParty Name="urn:mace:inqueue" TLS="inqueuecreds" Signing="inqueuecreds"/>
            -->
        </CredentialUse>

        <saml:AttributeDesignator AttributeName="urn:mace:dir:attribute-def:eduPersonScopedAffiliation"
            AttributeNamespace="urn:mace:shibboleth:1.0:attributeNamespace:uri"/>
        <saml:AttributeDesignator AttributeName="urn:mace:dir:attribute-def:eduPersonTargetedID"
            AttributeNamespace="urn:mace:shibboleth:1.0:attributeNamespace:uri"/>

        <!-- AAP can be inline or in a separate file -->
        <AAPProvider type="edu.internet2.middleware.shibboleth.serviceprovider.XMLAAP"
        uri="/conf/AAP.xml"/>

        <!-- Metadata consists of site/operational metadata, trust, revocation providers. Can be external or inline. -->
        <FederationProvider type="edu.internet2.middleware.shibboleth.common.provider.XMLMetadata"
            uri="/conf/ExampleMetadata.xml"/>

        <!--
        Revocation using X.509 CRLs is an optional feature in some trust metadata or you may
        supply your own revocation information locally.
        -->
        <!--
        <RevocationProvider type="edu.internet2.middleware.shibboleth.common.provider.XMLRevocation"
            uri="/conf/IQ-trust.xml"/>
        -->

        <!-- zero or more SAML Audience condition matches -->
        <saml:Audience>urn:mace:shibdev</saml:Audience>


    </Applications>

    <!-- Define all the private keys and certificates here that you reference from <CredentialUse>. -->
    <CredentialsProvider type="edu.internet2.middleware.shibboleth.common.Credentials">
        <Credentials xmlns="urn:mace:shibboleth:credentials:1.0">
            <FileResolver Id="defcreds">
                <Key format="PEM">
                    <Path>/conf/localhost.key</Path>
                </Key>
                <Certificate format="PEM">
                    <Path>/conf/localhost.crt</Path>
                </Certificate>
            </FileResolver>
        </Credentials>
    </CredentialsProvider>

</ShibbolethTargetConfig>

