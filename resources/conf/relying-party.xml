<?xml version="1.0" encoding="UTF-8"?>

<!--
    This file specifies relying party dependent configurations for the IdP, for example, whether SAML assertions to a 
    particular relying party should be signed.  It also includes metadata provider and credential definitions used 
    when answering requests to a relying party.
-->

<RelyingPartyGroup xmlns="urn:mace:shibboleth:2.0:relying-party"
                   xmlns:saml="urn:mace:shibboleth:2.0:relying-party:saml"
                   xmlns:metadata="urn:mace:shibboleth:2.0:metadata"
                   xmlns:security="urn:mace:shibboleth:2.0:security"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="urn:mace:shibboleth:2.0:relying-party classpath:/schema/shibboleth-2.0-relying-party.xsd
                                       urn:mace:shibboleth:2.0:relying-party:saml classpath:/schema/shibboleth-2.0-relying-party-saml.xsd
                                       urn:mace:shibboleth:2.0:metadata classpath:/schema/shibboleth-2.0-metadata.xsd
                                       urn:mace:shibboleth:2.0:security classpath:/schema/shibboleth-2.0-security.xsd
                                       urn:oasis:names:tc:SAML:2.0:metadata classpath:/schema/saml-schema-metadata-2.0.xsd">
                                       
    <!-- ========================================== -->
    <!--      Relying Party Configurations          -->
    <!-- ========================================== -->
    <AnonymousRelyingParty provider="http://example.org/IdP" />
    
    <DefaultRelyingParty provider="http://example.org/IdP" />
    
    <RelyingParty id="urn:example.org:myFederation"
                  provider="urn:example.org:myFederation:idp1">
        <ProfileConfiguration xsi:type="saml:ShibbolethSSOProfile" />
        <ProfileConfiguration xsi:type="saml:SAML1AttributeQueryProfile" />
        <ProfileConfiguration xsi:type="saml:SAML2SSOProfile" />
        <ProfileConfiguration xsi:type="saml:SAML2AttributeQueryProfile" />
    </RelyingParty>
    
    
    <!-- ========================================== -->
    <!--      Metadata Configuration                -->
    <!-- ========================================== -->

    <!-- MetadataProvider reading metadata from a URL. -->
    <!-- Fill in metadataURL and backingFile attributes with deployment specific information -->
    <!--
    <MetadataProvider id="URLMD" xsi:type="FileBackedHTTPMetadataProvider" xmlns="urn:mace:shibboleth:2.0:metadata"
                      metadataURL="http://example.org/my/metadata/file.xml" backingFile="/path/to/temp/location" />
    -->
                  
    <!-- MetadataProvider reading metadata from the filesystem -->
    <!-- Fill in metadataFile attribute with deployment specific information -->
    <!--
    <MetadataProvider id="FSMD" xsi:type="FilesystemMetadataProvider" xmlns="urn:mace:shibboleth:2.0:metadata"
                      metadataFile="/path/to/metadata/file.xml" />
    -->
    
    <!-- MetadataProvider defining metadata inline -->
    <!--
    <MetadataProvider id="InlineMD" xsi:type="InlineMetadataProvider" xmlns="urn:mace:shibboleth:2.0:metadata">
        <EntitiesDescriptor Name="urn:example.org:myFederation" xmlns="urn:oasis:names:tc:SAML:2.0:metadata">
            <EntityDescriptor entityID="urn:example.org:myFederation:idp1">
                <IDPSSODescriptor protocolSupportEnumeration="urn:oasis:names:tc:SAML:2.0:protocol">
                    <SingleSignOnService Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST" Location="https://example.org/myIdP" />
                </IDPSSODescriptor>
            </EntityDescriptor>
            <EntityDescriptor entityID="urn:example.org:myFederation:sp1">
                <SPSSODescriptor protocolSupportEnumeration="urn:oasis:names:tc:SAML:2.0:protocol">
                    <AssertionConsumerService Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST" Location="https://example.org/mySP" index="0" />
                    <AssertionConsumerService Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect" Location="https://example.org/mySP" index="0" />
                </SPSSODescriptor>
            </EntityDescriptor>
        </EntitiesDescriptor>
    </MetadataProvider>
    -->
    
    <!-- MetadataProvider the combining other MetadataProviders -->
    <!--
    <MetadataProvider id="ExampleMD" xsi:type="ChainingMetadataProvider" xmlns="urn:mace:shibboleth:2.0:metadata">
        <MetadataProvider id="URLMD" xsi:type="FileBackedHTTPMetadataProvider"
                      metadataURL="http://example.org/my/metadata" backingFile="/path/to/temp/location" />
        <MetadataProvider id="FSMD" xsi:type="FilesystemMetadataProvider" metadataFile="/path/to/metadata/file.xml" />
    </MetadataProvider>
    -->
    
    <security:SecurityPolicy id="DefaultPolicy" xsi:type="security:SecurityPolicyType">
        <security:Rule xsi:type="SAML1Protocol"/>
        <security:Rule xsi:type="SAML2Protocol"/>
        <security:Rule xsi:type="Replay"/>
        <security:Rule xsi:type="IssueInstant"/>
        <security:Rule xsi:type="MandatoryIssuer"/>
    </security:SecurityPolicy>
    
</RelyingPartyGroup>